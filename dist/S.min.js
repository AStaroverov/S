!function(){"use strict";function t(){return this()}var n=null,e=null,i=function(i){function r(){if(g){var t,e,i=g,o=i.receiver,r=i.cleanups;if(g=null,n===i&&(n=null),o)for(t=-1,e=o.inbound.length;++t<e;)o.inbound[t].deactivate();for(i.cleanups=[],t=-1,e=r.length;++t<e;)r[t]();for(t=-1,e=i.finalizers.length;++t<e;)i.finalizers[t]();i.value=null,i.fn=null,i.finalizers=null,i.receiver=null,i.emitter=null}}var u,c,h,a=this instanceof o?this:new o,f=n,d=e.collecting,p=a._gate||f&&f.gate||null,g=new s(i,p);if(n=g,a._sources){for(u=-1,c=a._sources.length;++u<c;)try{a._sources[u]()}catch(m){throw n=f,m}g.listening=!1}f&&(f.pinning||a._pin?f.finalizers.push(r):f.cleanups.push(r)),d||(e.collecting=!0);try{g.value=i()}finally{n=f,d||(e.collecting=!1)}return d||0===e.len||e.run(null),h=function(){return g&&(n&&n.listening&&(g.emitter||(g.emitter=new l(g)),g.emitter.addEdge(n)),g.receiver&&0!==g.receiver.marks&&g.receiver.backtrack(),g)?g.value:void 0},h.dispose=r,h.toJSON=t,h};i.data=function a(i){var a,o=new u(i);return o.value=i,a=function(t){return arguments.length>0?e.change(o,t):n&&n.listening&&(o.emitter||(o.emitter=new l(null)),o.emitter.addEdge(n)),o.value},a.toJSON=t,a};var o=function(){function t(){this._sources=null,this._pin=!1,this._gate=null}return t.prototype.pin=function(){return this._pin=!0,this},t.prototype.gate=function(t){return this._gate=t,this},t.prototype.S=function(t){return i(t)},t}();o.prototype.S=i,i.on=function(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];var e=new o;return e._sources=t,e},i.gate=function(t){return(new o).gate(t)},i.collector=function f(){function t(){var t,r,u;for(e=!0,t=-1;++t<i.length;)r=i[t],r.emitter&&r.emitter.mark();u=n,n=null,t=-1;try{for(;++t<i.length;)i[t].update()}catch(s){for(t--;++t<i.length;)r=i[t],r.emitter&&r.emitter.reset();throw s}finally{n=u,e=!1}i=[],o=[]}var f,e=!1,i=[],o=[];return f=function(t){var n=t;return e||o[n.receiver.id]||(i.push(n),o[n.receiver.id]=n),e},f.go=t,f},i.throttle=function(t){var n=i.collector(),e=0;return function(i){var o=Date.now();return n(i),o-e>t?(e=o,n.go()):setTimeout(function(){e=Date.now(),n.go()},t-(o-e)),!1}},i.debounce=function(t){var n=i.collector(),e=0,o=0;return function(i){var r=Date.now();return n(i),r>e&&(e=r,o&&clearTimeout(o),o=setTimeout(n.go,t)),!1}},i.peek=function(t){if(!n||!n.listening)return t();n.listening=!1;try{return t()}finally{n.listening=!0}},i.cleanup=function(t){if(!n)throw new Error("S.cleanup() must be called from within an S.computation.  Cannot call it at toplevel.");n.cleanups.push(t)},i.freeze=function(t){var n;if(!e.collecting){e.collecting=!0;try{n=t()}finally{e.collecting=!1}return e.run(null),n}t()},i.pin=function(t){if(0===arguments.length)return(new o).pin();if(!n||n.pinning)return t();n.pinning=!0;try{return t()}finally{n.pinning=!1}};var r=function(){function t(){this.len=0,this.collecting=!1,this.changes=[],this.changes2=[],this.TopLevel=new s(null,null)}return t.prototype.change=function(t,e){var i=n||this.TopLevel;if(this.collecting)if(null!==t.setter){if(e!==t.pending)throw new Error("conflicting changes: "+e+" !== "+t.pending)}else t.pending=e,t.setter=i,this.changes[this.len]=t,this.len++;else t.value=e,t.emitter&&this.run(t)},t.prototype.run=function(t){var e,i,o,r=0,u=!1;if(t){t.emitter.mark(),this.collecting=!0;try{t.emitter.propagate(),u=!0}finally{if(!u){for(t.emitter.reset(),i=-1;++i<this.len;)t=this.changes[i],t.value=t.pending,t.pending=void 0,t.setter=null,this.changes[this.len]=null;this.len=0}this.collecting=!1,n=null}}for(;0!==this.len;){for(e=this.changes,o=this.len,this.changes=this.changes2,this.changes2=e,this.len=0,i=-1;++i<o;)t=e[i],t.value=t.pending,t.pending=void 0,t.setter=null,t.emitter&&t.emitter.mark();this.collecting=!0,i=-1;try{for(;++i<o;)t=e[i],t.emitter&&t.emitter.propagate(),e[i]=null}finally{for(i--;++i<o;)t=e[i],t.emitter&&t.emitter.reset(),e[i]=null;this.collecting=!1,n=null}if(r++>1e5){for(i=-1;++i<this.len;)this.changes[i]=null;throw this.len=0,new Error("Runaway frames detected")}}},t}(),u=function(){function t(t){this.value=void 0,this.setter=null,this.pending=void 0,this.emitter=null,this.value=t}return t}(),s=function(){function t(t,n){this.value=void 0,this.gen=1,this.emitter=null,this.receiver=null,this.listening=!0,this.pinning=!1,this.cleanups=[],this.finalizers=[],this.fn=t,this.gate=n}return t.prototype.update=function(){var t,e,i,o=this.cleanups;for(this.cleanups=[],t=-1,e=o.length;++t<e;)o[t]();if(n=this,this.gen++,this.fn&&(this.value=this.fn()),this.emitter&&this.emitter.propagate(),this.receiver&&this.listening){for(t=-1,e=this.receiver.inbound.length;++t<e;)i=this.receiver.inbound[t],i.active&&i.gen<this.gen&&i.deactivate();e>10&&e/this.receiver.inboundActive>4&&this.receiver.compact()}},t.prototype.cleanup=function(){},t}(),l=function(){function t(n){this.id=t.count++,this.emitting=!1,this.outbound=[],this.outboundIndex=[],this.outboundActive=0,this.outboundCompaction=0,this.node=n}return t.prototype.addEdge=function(t){var n=null;t.receiver?n=t.receiver.inboundIndex[this.id]:t.receiver=new c(t),n?n.activate(this):new h(this,t.receiver,t.gate&&(null===this.node||t.gate!==this.node.gate))},t.prototype.mark=function(){this.emitting=!0;for(var t,n,e=this.outbound,i=-1,o=e.length;++i<o;)if(t=e[i],t&&(!t.boundary||t.to.node.gate(t.to.node))){if(n=t.to,n.node.emitter&&n.node.emitter.emitting)throw new Error("circular dependency");t.marked=!0,n.marks++,1===n.marks&&n.node.emitter&&n.node.emitter.mark()}this.emitting=!1},t.prototype.propagate=function(){for(var t,n,e=-1,i=this.outbound.length;++e<i;)t=this.outbound[e],t&&t.marked&&(n=t.to,t.marked=!1,n.marks--,0===n.marks&&n.node.update());i>10&&i/this.outboundActive>4&&this.compact()},t.prototype.reset=function(){var t,n=this.outbound,e=-1,i=n.length;for(this.emitting=!1;++e<i;)t=n[e],t&&(t.marked=!1,t.to.marks=0,t.to.node.emitter&&t.to.node.emitter.reset())},t.prototype.compact=function(){for(var t,n=-1,e=this.outbound.length,i=[],o=++this.outboundCompaction;++n<e;)t=this.outbound[n],t&&(t.outboundOffset=i.length,t.outboundCompaction=o,i.push(t));this.outbound=i},t.count=0,t}(),c=function(){function t(t){this.id=l.count++,this.marks=0,this.inbound=[],this.inboundIndex=[],this.inboundActive=0,this.node=t}return t.prototype.backtrack=function(){for(var t,e=-1,i=this.inbound.length,o=n;++e<i;)t=this.inbound[e],t&&t.marked&&(t.from.node&&t.from.node.receiver.marks?t.from.node.receiver.backtrack():(t.from.propagate(),n=o))},t.prototype.compact=function(){for(var t,n=-1,e=this.inbound.length,i=[],o=[];++n<e;)t=this.inbound[n],t.active&&(i.push(t),o[t.from.id]=t);this.inbound=i,this.inboundIndex=o},t.count=0,t}(),h=function(){function t(t,n,e){this.active=!0,this.marked=!1,this.from=t,this.to=n,this.boundary=e,this.gen=n.node.gen,this.outboundOffset=t.outbound.length,this.outboundCompaction=t.outboundCompaction,t.outbound.push(this),n.inbound.push(this),n.inboundIndex[t.id]=this,t.outboundActive++,n.inboundActive++}return t.prototype.activate=function(t){this.active||(this.active=!0,this.outboundCompaction===t.outboundCompaction?t.outbound[this.outboundOffset]=this:(this.outboundCompaction=t.outboundCompaction,this.outboundOffset=t.outbound.length,t.outbound.push(this)),this.to.inboundActive++,t.outboundActive++,this.from=t),this.gen=this.to.node.gen},t.prototype.deactivate=function(){if(this.active){var t=this.from,n=this.to;this.active=!1,t.outbound[this.outboundOffset]=null,t.outboundActive--,n.inboundActive--,this.from=null}},t}();e=new r,"object"==typeof module&&"object"==typeof module.exports?module.exports=i:"function"==typeof define?define([],function(){return i}):(eval||function(){})("this").S=i}();