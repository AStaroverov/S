!function(){"use strict";function n(n){function t(){return k||(l(v),0!==v.marks&&f(v,m),k)?void 0:v.payload.value}function r(){if(!k){k=!0;var n,t;for(n=-1,t=v.inbound.length;++n<t;)p(v.inbound[n]);for(g(b),n=-1,t=b.finalizers.length;++n<t;)b.finalizers[n]();b.fn=null,b.value=null,b.finalizers=null,b=null,v.payload=null,v.inbound=null,v.inboundIndex=null,v.outbound=null,v=null}}var a,s,c=this instanceof o?this:new o,d=m,h=c._gate||d&&d.gate||null,b=new u(n),v=new i(++y,b,h),k=!1;if(m=v,c._sources){for(a=-1,s=c._sources.length;++a<s;)try{c._sources[a]()}catch(w){throw m=d,w}b.listening=!1}d&&(d.payload.pinning||c._pin?d.payload.finalizers.push(r):d.payload.cleanups.push(r)),v.trigger=d||v;try{(!c._init||c._init(v))&&(v.payload.value=n())}finally{k||(v.trigger=null),m=d}return t.dispose=r,t.toJSON=e,t}function t(n){var t;if(b)b(n);else{a(n),t=m,m=null;try{s(n,t||n)}catch(o){throw c(n),o}finally{m=t}}}function o(){this._sources=null,this._pin=!1,this._init=null,this._gate=null}function e(){return this()}function i(n,t,o){this.id=n,this.payload=t,this.gate=o,this.marks=0,this.trigger=null,this.cur=0,this.inbound=[],this.inboundIndex=[],this.outbound=[]}function r(n,t,o){this.from=n,this.to=t,this.boundary=o,this.active=!0,this.marked=!1,this.gen=t.payload.gen,this.outboundOffset=n.outbound.length,n.outbound.push(this),t.inbound.push(this),t.inboundIndex[n.id]=this}function u(n){this.fn=n,this.gen=1,this.value=void 0,this.listening=!0,this.pinning=!1,this.cleanups=[],this.finalizers=[]}function l(n){var t=m,o=null;t&&t.payload&&t.payload.listening&&(o=t.inboundIndex[n.id],o?h(o,n):new r(n,t,t.gate&&n.gate!==t.gate))}function a(n){n.trigger=n;for(var t,o,e=-1,i=n.outbound.length;++e<i;)if(t=n.outbound[e],t&&!t.marked&&(!t.boundary||t.to.gate(t.to))){if(o=t.to,o.trigger)throw new Error("circular dependency");t.marked=!0,o.marks++,1===o.marks&&a(o)}n.trigger=null}function s(n,t){var o,e,i,r,u;if(n.trigger=t,n.payload&&(u=n.payload,m=n,g(u),n.payload&&(u.gen++,u.value=u.fn(),u.listening&&n.inbound)))for(o=-1,e=n.inbound.length;++o<e;)i=n.inbound[o],i.active&&i.gen<u.gen&&p(i);for(n.cur=-1,e=n.outbound?n.outbound.length:0;++n.cur<e;)i=n.outbound[n.cur],i&&i.marked&&(r=i.to,i.marked=!1,r.marks--,0===r.marks&&s(r,n));n.trigger=null}function f(n,t){for(var o,e,i=-1,r=n.inbound.length;++i<r;)o=n.inbound[i],o&&o.marked&&(o.from.marked?f(o.from,t):(e=m,s(o.from,t),m=e))}function c(n){n.marks=0,n.trigger=null,n.cur=0;for(var t,o=-1,e=n.outbound.length;++o<e;)t=n.outbound[o],t&&(t.marked||t.to.trigger)&&(t.marked=!1,c(t.to))}function d(n){for(var t,o,e;n!==n.trigger&&(n=n.trigger);)for(t=n.outbound.length;++n.cur<t;)o=n.outbound[n.cur],o&&o.marked&&(e=o.to,o.marked=!1,e.marks--,0===e.marks&&s(e,n))}function g(n){var t=-1,o=n.cleanups,e=o.length;for(n.cleanups=[];++t<e;)o[t]()}function h(n,t){n.active||(n.active=!0,t.outbound[n.outboundOffset]=n,n.from=t),n.gen=n.to.payload.gen}function p(n){n.active&&(n.active=!1,n.from.outbound&&(n.from.outbound[n.outboundOffset]=null),n.from=null)}"object"==typeof module&&"object"==typeof module.exports?module.exports=n:"function"==typeof define?define([],function(){return n}):(eval||!1)("this").S=n;var y=0,m=null,b=null;n.data=function v(n){function v(e){return arguments.length>0?(m&&d(m),n=e,t(o)):l(o),n}var o=new i(++y,null,m?m.gate:null);return v.toJSON=e,v},o.prototype={pin:function(){return this._pin=!0,this},gate:function(n){return this._gate=n,this},S:n},n.on=function(){var n=new o;return n._sources=Array.prototype.slice.apply(arguments),n},n.when=function(){var n=new o,t=Array.prototype.slice.apply(arguments),e=t.length;return n._sources=t,n._gate=n._init=function(){for(var n=-1;++n<e;)if(void 0===t[n]())return!1;return!0},n},n.gate=function(n){return(new o).gate(n)},n.pin=function(){return(new o).pin()},n.collector=function k(){function k(n){return t||e[n.id]||(o.push(n),e[n.id]=n),t}function n(){var n,i;for(t=!0,n=-1;++n<o.length;)a(o[n]);i=m,m=null,n=-1;try{for(;++n<o.length;)s(o[n],o[n])}catch(r){for(n--;++n<o.length;)c(o[n]);throw r}finally{m=i,t=!1}o=[],e={}}var t=!1,o=[],e={};return k.go=n,k},n.throttle=function(t){var o=n.collector(),e=0;return function(n){var i=Date.now();o(n),i-e>t?(e=i,o.go()):setTimeout(function(){e=Date.now(),o.go()},t-(i-e))}},n.debounce=function(t){var o=n.collector(),e=0,i=0;return function(n){var r=Date.now();o(n),r>e&&(e=r,i&&clearTimeout(i),i=setTimeout(o.go,t))}},n.peek=function(n){if(!(m&&m.payload&&m.payload.listening))return n();m.payload.listening=!1;try{return n()}finally{m.payload&&(m.payload.listening=!0)}},n.cleanup=function(n){if(!m||!m.payload)throw new Error("S.cleanup() must be called from within an S.computation.  Cannot call it at toplevel.");m.payload.cleanups.push(n)},n.freeze=function w(t){if(b)t();else{var w=b=n.collector();try{t()}finally{b=null}w.go()}}}();