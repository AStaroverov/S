!function(){"use strict";function n(n){function t(){return k||(l(v),0!==v.marks&&f(v,y),k)?void 0:v.payload.value}function i(){if(!k){k=!0;var n,t;for(n=-1,t=v.inbound.length;++n<t;)p(v.inbound[n]);for(g(m),n=-1,t=m.finalizers.length;++n<t;)m.finalizers[n]();m.fn=null,m.value=null,m.finalizers=null,m=null,v.payload=null,v.inbound=null,v.inboundIndex=null,v.outbound=null,v=null}}var a,d,s=this instanceof o?this:new o,c=y,h=s._gate||c&&c.gate||null,m=new r(n),v=new e(++b,m,h),k=!1;if(y=v,s._sources){for(a=-1,d=s._sources.length;++a<d;)try{s._sources[a]()}catch(w){throw y=c,w}m.listening=!1}c&&(c.payload.pinning||s._pin?c.payload.finalizers.push(i):c.payload.cleanups.push(i)),v.trigger=c||v;try{(!s._init||s._init(v))&&(v.payload.value=n())}finally{k||(v.trigger=null),y=c}return t.dispose=i,t.toJSON=u,t}function t(n){var t;if(m)m(n);else{a(n),t=y,y=null;try{d(n,t||n)}catch(o){throw s(n),o}finally{y=t}}}function o(){this._sources=null,this._pin=!1,this._init=null,this._gate=null}function u(){return this()}function e(n,t,o){this.id=n,this.payload=t,this.gate=o,this.marks=0,this.trigger=null,this.cur=0,this.inbound=[],this.inboundIndex=[],this.outbound=[],this.outboundGen=0}function i(n,t,o){this.from=n,this.to=t,this.boundary=o,this.active=!0,this.marked=!1,this.gen=t.payload.gen,this.outboundOffset=n.outbound.length,this.outboundGen=n.outboundGend,n.outbound.push(this),t.inbound.push(this),t.inboundIndex[n.id]=this}function r(n){this.fn=n,this.gen=1,this.value=void 0,this.listening=!0,this.pinning=!1,this.cleanups=[],this.finalizers=[]}function l(n){var t=y,o=null;t&&t.payload&&t.payload.listening&&(o=t.inboundIndex[n.id],o?h(o,n):new i(n,t,t.gate&&n.gate!==t.gate))}function a(n){n.trigger=n;for(var t,o,u=-1,e=n.outbound.length;++u<e;)if(t=n.outbound[u],t&&!t.marked&&(!t.boundary||t.to.gate(t.to))){if(o=t.to,o.trigger)throw new Error("circular dependency");t.marked=!0,o.marks++,1===o.marks&&a(o)}n.trigger=null}function d(n,t){var o,u,e,i,r,l,a,f;if(n.trigger=t,n.payload&&(r=n.payload,y=n,g(r),n.payload&&(r.gen++,r.value=r.fn(),r.listening&&n.inbound))){for(o=-1,u=n.inbound.length,l=0;++o<u;)e=n.inbound[o],e.active&&(e.gen<r.gen?p(e):l++);if(u/l>4){for(o=-1,a=[],f=[];++o<u;)e=n.inbound[o],e.active&&(a.push(e),f[e.from.id]=e);n.inbound=a,n.inboundIndex=f}}for(n.cur=-1,u=n.outbound?n.outbound.length:0,l=0;++n.cur<u;)e=n.outbound[n.cur],e&&(l++,e.marked&&(i=e.to,e.marked=!1,i.marks--,0===i.marks&&d(i,n)));if(u/l>4){for(n.outboundGen++,o=-1,a=[];++o<u;)e=n.outbound[o],e&&(e.outboundOffset=a.length,e.outboundGen=n.outboundGen,a.push(e));n.outbound=a}n.trigger=null}function f(n,t){for(var o,u,e=-1,i=n.inbound.length;++e<i;)o=n.inbound[e],o&&o.marked&&(o.from.marked?f(o.from,t):(u=y,d(o.from,t),y=u))}function s(n){n.marks=0,n.trigger=null,n.cur=0;for(var t,o=-1,u=n.outbound.length;++o<u;)t=n.outbound[o],t&&(t.marked||t.to.trigger)&&(t.marked=!1,s(t.to))}function c(n){for(var t,o,u;n!==n.trigger&&(n=n.trigger);)for(t=n.outbound.length;++n.cur<t;)o=n.outbound[n.cur],o&&o.marked&&(u=o.to,o.marked=!1,u.marks--,0===u.marks&&d(u,n))}function g(n){var t=-1,o=n.cleanups,u=o.length;for(n.cleanups=[];++t<u;)o[t]()}function h(n,t){n.active||(n.active=!0,n.outboundGen===t.outboundGen?t.outbound[n.outboundOffset]=n:(n.outboundGen=t.outboundGen,n.outboundOffset=t.outbound.length,t.outbound.push(n)),n.from=t),n.gen=n.to.payload.gen}function p(n){n.active&&(n.active=!1,n.from.outbound&&(n.from.outbound[n.outboundOffset]=null),n.from=null)}"object"==typeof module&&"object"==typeof module.exports?module.exports=n:"function"==typeof define?define([],function(){return n}):(eval||!1)("this").S=n;var b=0,y=null,m=null;n.data=function v(n){function v(u){return arguments.length>0?(y&&c(y),n=u,t(o)):l(o),n}var o=new e(++b,null,y?y.gate:null);return v.toJSON=u,v},o.prototype={pin:function(){return this._pin=!0,this},gate:function(n){return this._gate=n,this},S:n},n.on=function(){var n=new o;return n._sources=Array.prototype.slice.apply(arguments),n},n.when=function(){var n=new o,t=Array.prototype.slice.apply(arguments),u=t.length;return n._sources=t,n._gate=n._init=function(){for(var n=-1;++n<u;)if(void 0===t[n]())return!1;return!0},n},n.gate=function(n){return(new o).gate(n)},n.pin=function(){return(new o).pin()},n.collector=function k(){function k(n){return t||u[n.id]||(o.push(n),u[n.id]=n),t}function n(){var n,e;for(t=!0,n=-1;++n<o.length;)a(o[n]);e=y,y=null,n=-1;try{for(;++n<o.length;)d(o[n],o[n])}catch(i){for(n--;++n<o.length;)s(o[n]);throw i}finally{y=e,t=!1}o=[],u={}}var t=!1,o=[],u={};return k.go=n,k},n.throttle=function(t){var o=n.collector(),u=0;return function(n){var e=Date.now();o(n),e-u>t?(u=e,o.go()):setTimeout(function(){u=Date.now(),o.go()},t-(e-u))}},n.debounce=function(t){var o=n.collector(),u=0,e=0;return function(n){var i=Date.now();o(n),i>u&&(u=i,e&&clearTimeout(e),e=setTimeout(o.go,t))}},n.peek=function(n){if(!(y&&y.payload&&y.payload.listening))return n();y.payload.listening=!1;try{return n()}finally{y.payload&&(y.payload.listening=!0)}},n.cleanup=function(n){if(!y||!y.payload)throw new Error("S.cleanup() must be called from within an S.computation.  Cannot call it at toplevel.");y.payload.cleanups.push(n)},n.freeze=function w(t){if(m)t();else{var w=m=n.collector();try{t()}finally{m=null}w.go()}}}();