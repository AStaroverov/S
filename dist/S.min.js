!function(){"use strict";function t(){return this()}var e=null,n=null,i=function(i){function o(){if(d){var t,n,i=d,r=i.receiver,o=i.cleanups;if(d=null,e===i&&(e=null),r)for(t=-1,n=r.edges.length;++t<n;)r.edges[t].deactivate();for(i.cleanups=[],t=-1,n=o.length;++t<n;)o[t]();for(t=-1,n=i.finalizers.length;++t<n;)i.finalizers[t]();i.value=null,i.fn=null,i.finalizers=null,i.receiver=null,i.emitter=null}}var s,a,h,u=this instanceof r?this:new r,g=e,f=n.collecting,p=u._gate||g&&g.gate||null,d=new c(i,p);if(e=d,u._sources){for(s=-1,a=u._sources.length;++s<a;)try{u._sources[s]()}catch(v){throw e=g,v}d.listening=!1}g&&(g.pinning||u._pin?g.finalizers.push(o):g.cleanups.push(o)),f||(n.collecting=!0);try{d.value=i()}finally{e=g,f||(n.collecting=!1)}return f||0===n.len||n.run(null),h=function(){return d&&(e&&e.listening&&(d.emitter||(d.emitter=new l(d)),d.emitter.addEdge(e)),d.receiver&&0!==d.receiver.marks&&d.receiver.backtrack(),d)?d.value:void 0},h.dispose=o,h.toJSON=t,h};i.data=function u(i){var u,r=new s(i);return r.value=i,u=function(t){return arguments.length>0?n.change(r,t):e&&e.listening&&(r.emitter||(r.emitter=new l(null)),r.emitter.addEdge(e)),r.value},u.toJSON=t,u};var r=function(){function t(){this._sources=null,this._pin=!1,this._gate=null}return t.prototype.pin=function(){return this._pin=!0,this},t.prototype.gate=function(t){return this._gate=t,this},t.prototype.S=function(t){return i(t)},t}();r.prototype.S=i,i.on=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];var n=new r;return n._sources=t,n},i.gate=function(t){return(new r).gate(t)},i.collector=function g(){function t(){r=!0,n.run(e),r=!1}var g,e=new s(null),i=e.emitter=new l(null),r=!1;return g=function(t){var e=t;return r||i.addEdge(e),r},g.go=t,g},i.throttle=function(t){var e=i.collector(),n=0;return function(i){var r=Date.now();return e(i),r-n>t?(n=r,e.go()):setTimeout(function(){n=Date.now(),e.go()},t-(r-n)),!1}},i.debounce=function(t){var e=i.collector(),n=0,r=0;return function(i){var o=Date.now();return e(i),o>n&&(n=o,r&&clearTimeout(r),r=setTimeout(e.go,t)),!1}},i.peek=function(t){if(!e||!e.listening)return t();e.listening=!1;try{return t()}finally{e.listening=!0}},i.cleanup=function(t){if(!e)throw new Error("S.cleanup() must be called from within an S.computation.  Cannot call it at toplevel.");e.cleanups.push(t)},i.freeze=function(t){var e;if(!n.collecting){n.collecting=!0;try{e=t()}finally{n.collecting=!1}return n.run(null),e}t()},i.pin=function(t){if(0===arguments.length)return(new r).pin();if(!e||e.pinning)return t();e.pinning=!0;try{return t()}finally{e.pinning=!1}};var o=function(){function t(){this.len=0,this.collecting=!1,this.changes=[],this.changes2=[],this.TopLevel=new c(null,null)}return t.prototype.change=function(t,n){var i=e||this.TopLevel;if(this.collecting)if(null!==t.setter){if(n!==t.pending)throw new Error("conflicting changes: "+n+" !== "+t.pending)}else t.pending=n,t.setter=i,this.changes[this.len]=t,this.len++;else t.value=n,t.emitter&&this.run(t)},t.prototype.run=function(t){var n,i,r,o=0,s=!1;if(t){t.emitter.mark(),this.collecting=!0;try{t.emitter.propagate(),s=!0}finally{if(!s){for(t.emitter.reset(),i=-1;++i<this.len;)t=this.changes[i],t.value=t.pending,t.pending=void 0,t.setter=null,this.changes[this.len]=null;this.len=0}this.collecting=!1,e=null}}for(;0!==this.len;){for(n=this.changes,r=this.len,this.changes=this.changes2,this.changes2=n,this.len=0,i=-1;++i<r;)t=n[i],t.value=t.pending,t.pending=void 0,t.setter=null,t.emitter&&t.emitter.mark();this.collecting=!0,i=-1;try{for(;++i<r;)t=n[i],t.emitter&&t.emitter.propagate(),n[i]=null}finally{for(i--;++i<r;)t=n[i],t.emitter&&t.emitter.reset(),n[i]=null;this.collecting=!1,e=null}if(o++>1e5){for(i=-1;++i<this.len;)this.changes[i]=null;throw this.len=0,new Error("Runaway frames detected")}}},t}(),s=function(){function t(t){this.value=void 0,this.setter=null,this.pending=void 0,this.emitter=null,this.value=t}return t}(),c=function(){function t(t,e){this.value=void 0,this.gen=1,this.emitter=null,this.receiver=null,this.listening=!0,this.pinning=!1,this.cleanups=[],this.finalizers=[],this.fn=t,this.gate=e}return t.prototype.update=function(){var t,n,i,r=this.cleanups;for(this.cleanups=[],t=-1,n=r.length;++t<n;)r[t]();if(e=this,this.gen++,this.fn&&(this.value=this.fn()),this.emitter&&this.emitter.propagate(),this.receiver&&this.listening){for(t=-1,n=this.receiver.edges.length;++t<n;)i=this.receiver.edges[t],i.active&&i.gen<this.gen&&i.deactivate();n>10&&n/this.receiver.active>4&&this.receiver.compact()}},t.prototype.cleanup=function(){},t}(),l=function(){function t(e){this.id=t.count++,this.emitting=!1,this.edges=[],this.index=[],this.active=0,this.compaction=0,this.node=e}return t.prototype.addEdge=function(t){var e=null;t.receiver?e=t.receiver.index[this.id]:t.receiver=new a(t),e?e.activate(this):new h(this,t.receiver,t.gate&&(null===this.node||t.gate!==this.node.gate))},t.prototype.mark=function(){var t,e,n,i=this.edges,r=-1,o=i.length;for(this.emitting=!0;++r<o;)if(t=i[r],t&&(!t.boundary||t.to.node.gate(t.to.node))){if(e=t.to,n=e.node.emitter,n&&n.emitting)throw new Error("circular dependency");t.marked=!0,e.marks++,1===e.marks&&n&&n.mark()}this.emitting=!1},t.prototype.propagate=function(){for(var t,e,n=-1,i=this.edges.length;++n<i;)t=this.edges[n],t&&t.marked&&(e=t.to,t.marked=!1,e.marks--,0===e.marks&&e.node.update());i>10&&i/this.active>4&&this.compact()},t.prototype.reset=function(){var t,e=this.edges,n=-1,i=e.length;for(this.emitting=!1;++n<i;)t=e[n],t&&(t.marked=!1,t.to.marks=0,t.to.node.emitter&&t.to.node.emitter.reset())},t.prototype.compact=function(){for(var t,e=-1,n=this.edges.length,i=[],r=++this.compaction;++e<n;)t=this.edges[e],t&&(t.slot=i.length,t.compaction=r,i.push(t));this.edges=i},t.count=0,t}(),a=function(){function t(t){this.id=l.count++,this.marks=0,this.edges=[],this.index=[],this.active=0,this.node=t}return t.prototype.backtrack=function(){for(var t,n=-1,i=this.edges.length,r=e;++n<i;)t=this.edges[n],t&&t.marked&&(t.from.node&&t.from.node.receiver.marks?t.from.node.receiver.backtrack():(t.from.propagate(),e=r))},t.prototype.compact=function(){for(var t,e=-1,n=this.edges.length,i=[],r=[];++e<n;)t=this.edges[e],t.active&&(i.push(t),r[t.from.id]=t);this.edges=i,this.index=r},t.count=0,t}(),h=function(){function t(t,e,n){this.active=!0,this.marked=!1,this.from=t,this.to=e,this.boundary=n,this.gen=e.node.gen,this.slot=t.edges.length,this.compaction=t.compaction,t.edges.push(this),e.edges.push(this),e.index[t.id]=this,t.active++,e.active++}return t.prototype.activate=function(t){this.active||(this.active=!0,this.compaction===t.compaction?t.edges[this.slot]=this:(this.compaction=t.compaction,this.slot=t.edges.length,t.edges.push(this)),this.to.active++,t.active++,this.from=t),this.gen=this.to.node.gen},t.prototype.deactivate=function(){if(this.active){var t=this.from,e=this.to;this.active=!1,t.edges[this.slot]=null,t.active--,e.active--,this.from=null}},t}();n=new o,"object"==typeof module&&"object"==typeof module.exports?module.exports=i:"function"==typeof define?define([],function(){return i}):(eval||function(){})("this").S=i}();