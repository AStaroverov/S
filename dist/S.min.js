!function(t){var n={};t(function(t,e,i){if(n.hasOwnProperty(t))throw new Error("define: cannot redefine module "+t);n[t]=i.apply(null,e.map(function(e){if(!n.hasOwnProperty(e))throw new Error("define: module "+e+" required by "+t+" has not been defined.");return n[e]}))}),"object"==typeof module&&"object"==typeof module.exports?module.exports=n.S:"function"==typeof define?define([],function(){return n.S}):this.S=n.S}(function(t){"use strict";t("Source",[],function(){function t(t){this.id=t.count++,this.lineage=t.ctx?t.ctx.lineage:[],this.updates=[]}return t.prototype={propagate:function(){var t,n,e=this.updates;for(t=0;t<e.length;t++)n=e[t],n&&n()}},t}),t("Dependency",[],function(){function t(t,n){this.active=!0,this.gen=t.gen,this.updates=n.updates,this.offset=n.updates.length;for(var e=0,i=Math.min(t.lineage.length,n.lineage.length);i>e&&t.lineage[e]===n.lineage[e];e++);this.update=t.updaters[e],this.updates.push(this.update),t.dependencies.push(this),t.dependenciesIndex[n.id]=this}return t.prototype={activate:function(t){this.active||(this.active=!0,this.updates[this.offset]=this.update),this.gen=t},deactivate:function(){this.active&&(this.updates[this.offset]=null),this.active=!1}},t}),t("Context",["Dependency"],function(t){function n(t,n,e){var i,o;for(this.lineage=e.ctx?e.ctx.lineage.slice(0):[],this.lineage.push(this),this.mod=n.update,this.updaters=[],this.updating=!1,this.listening=!0,this.gen=1,this.dependencies=[],this.dependenciesIndex={},this.cleanups=[],this.finalizers=[],i=this.lineage.length-1;i>=0;i--)o=this.lineage[i],o.mod&&(t=o.mod(t,this)),this.updaters[i]=t;n.sources&&(e.runInContext(function(){for(var t=0;t<n.sources.length;t++)n.sources[t]()},this),this.listening=!1)}return n.prototype={beginUpdate:function(){this.cleanup(),this.gen++},endUpdate:function(){if(this.listening){var t,n;for(t=0;t<this.dependencies.length;t++)n=this.dependencies[t],n.active&&n.gen<this.gen&&n.deactivate()}},addSource:function(n){if(this.listening){var e=this.dependenciesIndex[n.id];e?e.activate(this.gen):new t(this,n)}},addChild:function(t){this.cleanups.push(t)},cleanup:function(){for(var t=0;t<this.cleanups.length;t++)this.cleanups[t]();this.cleanups=[]},dispose:function(){var t;for(t=0;t<this.finalizers.length;t++)this.finalizers[t]();for(t=this.dependencies.length-1;t>=0;t--)this.dependencies[t].deactivate()}},n}),t("Environment",[],function(){function t(){this.count=1,this.toplevel=!0,this.ctx=null,this.deferred=[]}return t.prototype={runInContext:function(t,n){if(!n.updating){var e,i,o;e=this.ctx,this.ctx=n,o=this.toplevel,this.toplevel=!1,n.beginUpdate(),n.updating=!0;try{i=t()}finally{n.updating=!1,this.ctx=e,this.toplevel=o}return n.endUpdate(),i}},runWithoutListening:function(t){var n;this.ctx&&(n=this.ctx.listening,this.ctx.listening=!1);try{return t()}finally{this.ctx&&(this.ctx.listening=n)}},runDeferred:function(){if(this.toplevel)for(;0!==this.deferred.length;)this.deferred.shift()()}},t}),t("S",["Environment","Source","Context"],function(t,n,e){function i(t,n){return i.lift(t,n)}function o(t,n){return"function"==typeof t?u(t,n):t instanceof Array?i.seq(t):r(t)}function r(t){function e(n){if(arguments.length>0){if(void 0===n)throw new Error("S.data can't be set to undefined.  In S, undefined is reserved for namespace lookup failures.");t=n,i.propagate(),l.runDeferred()}else l.ctx&&l.ctx.addSource(i);return t}if(void 0===t)throw new Error("S.data can't be initialized with undefined.  In S, undefined is reserved for namespace lookup failures.");var i=new n(l);return e.toString=s,e}function u(t,i){function o(){return l.ctx&&l.ctx.addSource(a),f}function r(){l.runInContext(u,h)}function u(){var n=t();void 0!==n&&(f=n,l.ctx=null,a.propagate())}function s(){h.cleanup(),h.dispose()}function c(){return"[formula: "+(void 0!==f?f+" - ":"")+t+"]"}i=i||{};var f,a=new n(l),h=new e(r,i,l);return l.ctx&&l.ctx.addChild(s),o.dispose=s,o.toString=c,(i.init?i.init(r):r)(),l.runDeferred(),o}function s(){return"[data: "+i.peek(this)+"]"}function c(t){return l.runWithoutListening(t)}function f(t){l.toplevel?t():l.deferred.push(t)}function a(t){if(!l.ctx)throw new Error("S.cleanup() must be called from within an S.formula.  Cannot call it at toplevel.");l.ctx.cleanups.push(t)}function h(t){if(!l.ctx)throw new Error("S.finalize() must be called from within an S.formula.  Cannot call it at toplevel.");l.ctx.finalizers.push(t)}function d(t,n){return function(e){return 0!==arguments.length&&n(e),t()}}function p(t){return JSON.stringify(t,function(t,n){return"function"==typeof n&&n.S?n():n})}var l=new t;return i.lift=o,i.data=r,i.formula=u,i.peek=c,i.defer=f,i.proxy=d,i.cleanup=a,i.finalize=h,i.toJSON=p,i}),t("modifiers",["S"],function(t){function n(){return function(){}}function e(t){return void 0!==t?u(t):function(t){var n=!1;return function(){n||(n=!0,u(function(){n=!1,t()}))}}}function i(t){return function(n){var e=0,i=!1;return function(){if(!i){var o=Date.now();o-e>t?(e=o,n()):(i=!0,setTimeout(function(){e=Date.now(),i=!1,n()},t-(o-e)))}}}}function o(t){return function(n){var e=0,i=0;return function(){var o=Date.now();o>e&&(e=o,i&&clearTimeout(i),i=setTimeout(function(){n()},t))}}}function r(n){return function(e,i){var o,r=[],u=!1,s=t.on(n).S(function(){for(;!(o=n())&&r.length;){var t=r.shift();t()}});return i.finalizers.push(s.dispose),function(){if(o){if(u)return;u=!0,r.push(function(){u=!1,e()})}else e()}}}var u=t.defer;return{stop:n,defer:e,throttle:i,debounce:o,pause:r}}),t("FormulaOptionBuilder",["S","modifiers"],function(t,n){function e(){this.options={sources:null,update:null,init:null}}function i(t,n){return n?function(e){return t(n(e))}:t}function o(t,n){return t?t.concat(n):n}function r(t,n){t.options.update=i(n,t.options.update)}function u(t,n){t.options.init=i(n,t.options.init)}e.prototype={S:function(n){return t.formula(n,this.options)},on:function(t){return t=t?Array.isArray(t)?t:[t]:[],this.options.sources=o(this.options.sources,t),this},once:function(){return this.options.sources=[],this},skipFirst:function(){if(null===this.options.sources||0===this.options.sources.length)throw new Error("to use skipFirst, you must first have specified at least one dependency with .on(...)");return u(this,n.stop),this}},"defer throttle debounce pause".split(" ").map(function(t){e.prototype[t]=function(e){return r(this,n[t](e)),this}}),"on once defer throttle debounce pause".split(" ").map(function(n){t[n]=function(t){return(new e)[n](t)}})})});