!function(t){var n={};t(function(t,i,e){if(n.hasOwnProperty(t))throw new Error("define: cannot redefine module "+t);n[t]=e.apply(null,i.map(function(i){if(!n.hasOwnProperty(i))throw new Error("define: module "+i+" required by "+t+" has not been defined.");return n[i]}))}),"object"==typeof module&&"object"==typeof module.exports?module.exports=n.S:"function"==typeof define?define([],function(){return n.S}):this.S=n.S}(function(t){"use strict";t("graph",[],function(){function t(){this.nodeCount=0,this.updatingNode=null,this.deferredEmitters=null}function n(t,n){this.id=++t.nodeCount,this.node=n,this.outbound=[]}function i(t,i){this.graph=t,this.payload=i,this.emitter=new n(t,this),this.value=void 0,this.gen=1,this.dirty=0,this.dirtying=!1,this.updating=!1,this.listening=!0,this.pinning=!1,this.inbound=[],this.inboundIndex=[],this.cleanups=[],this.finalizers=[]}function e(t,n){this.from=t,this.to=n,this.active=!0,this.gen=n.gen,this.outboundOffset=t.outbound.length,t.outbound.push(this),n.inbound.push(this),n.inboundIndex[t.id]=this}function s(t){this.id=t.count++,this.lineage=t.target?t.target.lineage:[],this.updates=[]}function u(t,n,i){var e,s,u;for(this.lineage=i.target?i.target.lineage.slice(0):[],this.lineage.push(this),this.scheduler=n.update,this.listening=!0,this.pinning=n.pinning||!1,this.locked=!0,this.gen=1,this.dependencies=[],this.dependenciesIndex={},this.cleanups=[],this.finalizers=[],this.updaters=new Array(this.lineage.length+1),this.updaters[this.lineage.length]=t,e=this.lineage.length-1;e>=0;e--)s=this.lineage[e],s.scheduler&&(t=s.scheduler(t)),this.updaters[e]=t;if(n.sources){u=i.target,i.target=this,this.locked=!1;try{for(e=0;e<n.sources.length;e++)n.sources[e]()}finally{this.locked=!0,i.target=u}this.listening=!1}}function o(t,n){this.active=!0,this.gen=t.gen,this.updates=n.updates,this.offset=n.updates.length;for(var i=0,e=Math.min(t.lineage.length,n.lineage.length);e>i&&t.lineage[i]===n.lineage[i];i++);this.update=t.updaters[i],this.updates.push(this.update),t.dependencies.push(this),t.dependenciesIndex[n.id]=this}return t.prototype={reportChange:function(t){if(this.deferredEmitters)return void this.deferredEmitters.push(t);t.emitDirty();var n=this.updatingNode;this.updatingNode=null;try{t.emitUpdate()}finally{this.updatingNode=n}},freeze:function(t){var n,i,e,s;if(this.deferredEmitters)return void t();this.deferredEmitters=n=[];try{t()}finally{this.deferredEmitters=null}for(e=-1,s=n.length;++e<s;)n[e].emitDirty();i=this.updatingNode,this.updatingNode=null,e=-1;try{for(;++e<s;)n[e].emitUpdate()}finally{this.updatingNode=i}},addEdge:function(t){var n=this.updatingNode,i=null;n&&n.listening&&(i=n.inboundIndex[t.id],i?i.activate(t):i=new e(t,n))},addEntryPoint:function(){return new n(this,null)},addNode:function(t,n,e){var s,u,o,r=new i(this,t,n);if(o=this.updatingNode,this.updatingNode=r,n.sources){for(s=-1,u=n.sources.length;++s<u;)n.sources[s]();this.listening=!1}o&&(o.pinning||n.pin?o.finalizers.push(e):o.cleanups.push(e)),r.updating=!0;try{r.value=t()}finally{r.updating=!1,this.updatingNode=o}return r}},n.prototype={emitDirty:function(){for(var t,n=-1,i=this.outbound.length;++n<i;)t=this.outbound[n],t&&t.to.markDirty(t)},emitUpdate:function(){for(var t,n=-1,i=this.outbound.length;++n<i;)t=this.outbound[n],t&&t.to.update()},dispose:function(){this.node=null,this.outbound=null}},i.prototype={markDirty:function(t){this.dirtying?t.deactivate():1===++this.dirty&&(this.dirtying=!0,this.emitter.emitDirty(),this.dirtying=!1)},update:function(){var t,n,i;if(this.dirty--,0===this.dirty&&!this.updating){if(this.graph.updatingNode=this,this.cleanup(),this.gen++,this.updating=!0,this.value=this.payload(),this.updating=!1,this.listening)for(t=-1,n=this.inbound.length;++t<n;)i=this.inbound[t],i.active&&i.gen<this.gen&&i.deactivate();this.emitter.emitUpdate()}},cleanup:function(){for(var t=-1,n=this.cleanups.length;++t<n;)this.cleanups[t]();this.cleanups=[]},dispose:function(){var t,n;for(this.cleanup(),t=-1,n=this.finalizers.length;++t<n;)this.finalizers[t]();for(t=-1,n=this.inbound.length;++t<n;)this.inbound[t].deactivate();this.graph=null,this.payload=null,this.inbound=null,this.inboundIndex=null,this.cleanups=null,this.finalizers=null,this.emitter.dispose()}},e.prototype={activate:function(t){this.active||(this.active=!0,t.outbound[this.outboundOffset]=this,this.from=t),this.gen=this.to.gen},deactivate:function(){this.active&&(this.active=!1,this.from.outbound[this.outboundOffset]=null,this.from=null)}},s.prototype={propagate:function(){var t,n,i=this.updates,e=i.length;for(t=0;e>t;t++)n=i[t],n&&n()},dispose:function(){this.lineage=null,this.updates.length=0}},u.prototype={beginUpdate:function(){this.cleanup(),this.gen++},endUpdate:function(){if(this.listening){var t,n;for(t=0;t<this.dependencies.length;t++)n=this.dependencies[t],n.active&&n.gen<this.gen&&n.deactivate()}},addSubformula:function(t,n){if(this.locked)throw new Error("Cannot create a new subformula except while updating the parent");(n||this.pinning?this.finalizers:this.cleanups).push(t)},addSource:function(t){if(this.listening&&!this.locked){var n=this.dependenciesIndex[t.id];n?n.activate(this.gen,t):new o(this,t)}},cleanup:function(){for(var t=0;t<this.cleanups.length;t++)this.cleanups[t]();this.cleanups=[]},dispose:function(){var t;for(this.cleanup(),t=0;t<this.finalizers.length;t++)this.finalizers[t]();for(t=this.dependencies.length-1;t>=0;t--)this.dependencies[t].deactivate();this.lineage=null,this.scheduler=null,this.updaters=null,this.cleanups=null,this.finalizers=null,this.dependencies=null,this.dependenciesIndex=null}},o.prototype={activate:function(t,n){this.active||(this.active=!0,this.updates=n.updates,this.updates[this.offset]=this.update),this.gen=t},deactivate:function(){this.active&&(this.updates[this.offset]=null,this.updates=null),this.active=!1}},{Graph:t,Node:i,Edge:e}}),t("core",["graph"],function(t){function n(n){function i(i){return arguments.length>0?(n=i,t.reportChange(e)):t.addEdge(e),n}var e=t.addEntryPoint(null,null);return i.toJSON=s,i}function i(){this.sources=null,this.pin=!1,this.update=null,this.init=null}function e(n,i){function e(){return o?(t.addEdge(o.emitter),o.value):void 0}function u(){o&&(o.dispose(),o=void 0)}var o=t.addNode(n,i,u);return e.dispose=u,e.toJSON=s,e}function s(){return this()}function u(n){if(!t.updatingNode||!t.updatingNode.listening)return n();t.updatingNode.listening=!1;try{return n()}finally{t.updatingNode.listening=!0}}function o(n){if(!t.updatingNode||t.updatingNode.pinning)return n();t.updatingNode.pinning=!0;try{return n()}finally{t.updatingNode.pinning=!1}}function r(n){t.freeze(n)}function a(n){if(!t.updatingNode)throw new Error("S.cleanup() must be called from within an S.formula.  Cannot call it at toplevel.");t.updatingNode.cleanups.push(n)}function h(n){if(!t.updatingNode)throw new Error("S.finalize() must be called from within an S.formula.  Cannot call it at toplevel.");t.updatingNode.finalizers.push(n)}var t=new t.Graph;return{data:n,FormulaOptions:i,formula:e,freeze:r,peek:u,pin:o,cleanup:a,finalize:h}}),t("schedulers",["core"],function(t){function n(){return function(){}}function i(t){return function(n){var i=!1;return function(){i||(i=!0,t(function(){i=!1,n()}))}}}function e(){return i(t.defer)}function s(t){return function(n){var i=0,e=!1;return function(){if(!e){var s=Date.now();s-i>t?(i=s,n()):(e=!0,setTimeout(function(){i=Date.now(),e=!1,n()},t-(s-i)))}}}}function u(t){return function(n){var i=0,e=0;return function(){var s=Date.now();s>i&&(i=s,e&&clearTimeout(e),e=setTimeout(function(){n()},t))}}}function o(){function t(t){i.push(t)}function n(){for(var t=0;t<i.length;t++)i[t]();i=[]}var i=[];return t.go=n,t}function r(t){return function(n){for(var i=0;i<t.length;i++)if(void 0===t[i]())return;n()}}return{stop:n,pause:i,defer:e,throttle:s,debounce:u,stopsign:o,when:r}}),t("options",["core","schedulers"],function(t,n){function i(){this.options=new t.FormulaOptions}function e(t,n){return n?function(){return t(n())}:t}function s(t,n){return t?t.concat(n):n}function u(t,n){t.options.update=e(n,t.options.update)}function o(t,n){t.options.init=e(n,t.options.init)}return i.prototype={on:function(t){return t=t?Array.isArray(t)?t:[t]:[],this.options.sources=s(this.options.sources,t),this},once:function(){return this.options.sources=[],this},pin:function(){return this.options.pin=!0,this},when:function(t){t=t?Array.isArray(t)?t:[t]:[],this.options.sources=s(this.options.sources,t);var i=n.pause(n.when(t));return o(this,i),u(this,i),this}},"defer throttle debounce pause".split(" ").map(function(t){i.prototype[t]=function(i){return u(this,n[t](i)),this}}),{FormulaOptionsBuilder:i}}),t("misc",[],function(){function t(t,n){return function(i){return 0!==arguments.length&&n(i),t()}}return{proxy:t}}),t("S",["core","options","schedulers","misc"],function(t,n,i,e){function s(n){var i,e;return arguments.length>1&&(i=n,e=Array.prototype.slice.call(arguments,1),n=function(){return i.apply(null,e)}),t.formula(n,new t.FormulaOptions)}return s.data=t.data,s.peek=t.peek,s.cleanup=t.cleanup,s.finalize=t.finalize,"on once when defer throttle debounce pause".split(" ").map(function(t){s[t]=function(i){return(new n.FormulaOptionsBuilder)[t](i)}}),s.pin=function(i){return 0===arguments.length?(new n.FormulaOptionsBuilder).pin():void t.pin(i)},n.FormulaOptionsBuilder.prototype.S=function(n){var i,e;return arguments.length>1&&(i=n,e=Array.prototype.slice.call(arguments,1),n=function(){return i.apply(null,e)}),t.formula(n,this.options)},s.stopsign=i.stopsign,s.proxy=e.proxy,s})});