!function(){"use strict";function n(n){function e(){t=m+1,E?x.add(l):i(l)}var t=0,l=new v(null),r=n(e);return function(){return m===t?!1:(r&&r(),u(l,this),!0)}}function e(n){return function(){for(var e=0;e<n.length;e++)n[e]()}}function t(n,e){var t=e.id,u=n.nodes[t];u!==e&&(u!==R&&(n.ids[n.count++]=t),n.nodes[t]=e,e.sources[e.count++]=n)}function u(n,e){n.log||(n.log=new w),t(n.log,e)}function l(n,e){n.log||(n.log=new w),t(n.log,e)}function i(n){try{o(n)}finally{E=!1,b=null,S=!1,j=!1}}function r(n){try{n.value=n.fn(n.value),x.count>0&&o(null)}finally{E=!1,b=null,S=!1,j=!1}}function o(n){var e,t=0;for(E=!0,z.reset(),C.reset(),n&&(x.reset(),m++,c(n),z.run(s),C.run(h));0!==x.count;)if(e=x,x=A,A=e,x.reset(),m++,e.run(c),z.run(s),C.run(h),t++>1e5)throw new Error("Runaway frames detected")}function c(n){n.value=n.pending,n.pending=q,n.log&&a(n.log)}function a(n){for(var e=n.nodes,t=n.ids,u=0,l=0;l<n.count;l++){var i=t[l],r=e[i];r===R?(e[i]=k,u++):(r.age<m&&(r.age=m,r.hold&&r.hold()?r.state=B:(r.state=D,z.add(r),r.children&&f(r.children),r.log&&a(r.log))),u&&(t[l-u]=i))}u&&(n.count-=u)}function f(n){for(var e=0;e<n.length;e++){var t=n[e];t.age=m,t.state=B,t.children&&f(t.children)}}function s(n){if(n.state===D){var e=b,t=S;b=n,S=!1,n.state=F,d(n,!1),n.value=n.fn(n.value),n.state=B,b=e,S=t}}function d(n,e){var t=n.sources,u=n.cleanups,l=n.children;if(u){for(var i=0;i<u.length;i++)u[i](e);n.cleanups=null}if(l){for(var i=0;i<l.length;i++)h(l[i]);n.children=null}for(var i=0;i<n.count;i++)t[i].nodes[n.id]=R,t[i]=null;n.count=0}function h(n){n.fn=null,n.hold=null,n.log=null,d(n,!0),n.sources=null}var g=function(e,t,u){0===e.length&&(u=t,t=void 0);var i=b,o=S,c=new p(e,t,u&&u.defer?n(u.defer):i?i.hold:null);return b=c,S=!1,E?c.value=c.fn(c.value):(E=!0,x.reset(),r(c)),!i||u&&u.orphan||(i.children||(i.children=[])).push(c),b=i,S=o,function(){if(j)b?C.add(c):h(c);else if(b){if(c.age===m){if(c.state===F)throw new Error("circular dependency");s(c)}S||l(c,b)}return c.value}};g.on=function G(n,t,u,l,i){function G(e){return n(),l?l=!1:(S=!0,e=t(e),S=!1),e}return Array.isArray(n)&&(n=e(n)),l=!!l,g(G,u,i)},g.data=function(n){var e=new v(n);return function(n){if(arguments.length>0){if(E)if(e.pending!==q){if(n!==e.pending)throw new Error("conflicting changes: "+n+" !== "+e.pending)}else e.pending=n,x.add(e);else e.log?(e.pending=n,i(e)):e.value=n;return n}return b&&!S&&u(e,b),e.value}},g.sum=function(n){var e=new v(n);return function(t){return arguments.length>0?(E?e.pending!==q?e.pending=t(e.pending):(e.pending=t(e.value),x.add(e)):e.log?(e.pending=t(e.value),i(e)):e.value=t(e.value),n):(b&&!S&&u(e,b),e.value)}},g.freeze=function(n){var e;if(E)e=n();else{E=!0,x.reset();try{e=n(),i(null)}finally{E=!1}}return e},g.sample=function(n){var e;return b&&!S?(S=!0,e=n(),S=!1):e=n(),e},g.dispose=function(n){if(j)n();else{j=!0;try{n()}finally{j=!1}}},g.cleanup=function(n){if(!b)throw new Error("S.cleanup() must be called from within an S() computation.  Cannot call it at toplevel.");(b.cleanups||(b.cleanups=[])).push(n)};var v=function(){function n(n){this.value=n,this.pending=q,this.log=null}return n}(),p=function(){function n(e,t,u){this.fn=e,this.value=t,this.hold=u,this.id=n.count++,this.age=m,this.state=B,this.count=0,this.sources=[],this.log=null,this.children=null,this.cleanups=null}return n.count=0,n}(),w=function(){function n(){this.count=0,this.nodes=[],this.ids=[]}return n}(),y=function(){function n(){this.items=[],this.count=0}return n.prototype.reset=function(){this.count=0},n.prototype.add=function(n){this.items[this.count++]=n},n.prototype.run=function(n){for(var e=this.items,t=this.count,u=0;t>u;u++)n(e[u]),e[u]=null;this.count=0},n}(),m=1,E=!1,b=null,S=!1,j=!1,x=new y,A=new y,z=new y,C=new y,R=new p(null,null,null),k=new p(null,null,null),q={},B=0,D=1,F=2;"object"==typeof module&&"object"==typeof module.exports?module.exports=g:"function"==typeof define?define([],function(){return g}):(eval||function(){})("this").S=g}();