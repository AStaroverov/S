!function(t){var n={};t(function(t,e,i){if(n.hasOwnProperty(t))throw new Error("define: cannot redefine module "+t);n[t]=i.apply(null,e.map(function(e){if(!n.hasOwnProperty(e))throw new Error("define: module "+e+" required by "+t+" has not been defined.");return n[e]}))}),"object"==typeof module&&"object"==typeof module.exports?module.exports=n.S:"function"==typeof define?define([],function(){return n.S}):this.S=n.S}(function(t){"use strict";t("Source",[],function(){function t(t){this.id=t.count++,this.lineage=t.ctx?t.ctx.lineage:[],this.updates=[]}return t.prototype={propagate:function(){var t,n,e=this.updates;for(t=0;t<e.length;t++)n=e[t],n&&n()}},t}),t("Dependency",[],function(){function t(t,n){this.active=!0,this.gen=t.gen,this.updates=n.updates,this.offset=n.updates.length;for(var e=0,i=Math.min(t.lineage.length,n.lineage.length);i>e&&t.lineage[e]===n.lineage[e];e++);this.update=t.updaters[e],this.updates.push(this.update),t.dependencies.push(this),t.dependenciesIndex[n.id]=this}return t.prototype={activate:function(t){this.active||(this.active=!0,this.updates[this.offset]=this.update),this.gen=t},deactivate:function(){this.active&&(this.updates[this.offset]=null),this.active=!1}},t}),t("Context",["Dependency"],function(t){function n(t,n,e){var i,r;for(this.lineage=e.ctx?e.ctx.lineage.slice(0):[],this.lineage.push(this),this.mod=n.update,this.updaters=[],i=this.lineage.length-1;i>=0;i--)r=this.lineage[i],r.mod&&(t=r.mod(t)),this.updaters[i]=t;this.updating=!1,this.listening=!0,this.gen=1,this.dependencies=[],this.dependenciesIndex={},this.cleanups=[],this.finalizers=[],n.sources&&(e.runInContext(function(){for(var t=0;t<n.sources.length;t++)n.sources[t]()},this),this.listening=!1)}return n.prototype={beginUpdate:function(){this.cleanup(),this.gen++,this.updating=!0},endUpdate:function(){if(this.updating=!1,this.listening){var t,n;for(t=0;t<this.dependencies.length;t++)n=this.dependencies[t],n.active&&n.gen<this.gen&&n.deactivate()}},addSource:function(n){if(this.listening){var e=this.dependenciesIndex[n.id];e?e.activate(this.gen):new t(this,n)}},addChild:function(t){this.cleanups.push(t)},cleanup:function(){for(var t=0;t<this.cleanups.length;t++)this.cleanups[t]();this.cleanups=[]},dispose:function(){var t;for(t=0;t<this.finalizers.length;t++)this.finalizers[t]();for(t=this.dependencies.length-1;t>=0;t--)this.dependencies[t].deactivate()}},n}),t("Environment",[],function(){function t(){this.count=1,this.ctx=null,this.deferred=[]}return t.prototype={runInContext:function(t,n){if(!n.updating){var e;e=this.ctx,this.ctx=n,n.beginUpdate();try{return t()}finally{n.endUpdate(),this.ctx=e}}},runWithoutListening:function(t){var n;this.ctx&&(n=this.ctx.listening,this.ctx.listening=!1);try{return t()}finally{this.ctx&&(this.ctx.listening=n)}},runDeferred:function(){if(!this.ctx)for(;0!==this.deferred.length;)this.deferred.shift()()}},t}),t("S",["Environment","Source","Context"],function(t,n,e){function i(t,n){return i.lift(t,n)}function r(t,n){return"function"==typeof t?o(t,n):t instanceof Array?i.seq(t):u(t)}function u(t){function e(n){if(arguments.length>0){if(void 0===n)throw new Error("S.data can't be set to undefined.  In S, undefined is reserved for namespace lookup failures.");t=n,i.propagate(),g.runDeferred()}else g.ctx&&g.ctx.addSource(i);return t}if(void 0===t)throw new Error("S.data can't be initialized with undefined.  In S, undefined is reserved for namespace lookup failures.");var i=new n(g);return e.S=new s(e),e.toString=a,e}function o(t,i){function r(){return g.ctx&&g.ctx.addSource(h),f}function u(){g.runInContext(o,d)}function o(){var n=t();void 0!==n&&(f=n,h.propagate())}function s(){d.cleanup(),d.dispose()}function a(){return"[formula: "+(void 0!==f?f+" - ":"")+t+"]"}i=i||{};var f,h=new n(g),d=new e(u,i,g);return g.ctx&&g.ctx.addChild(s),r.S=new c(r,s),r.toString=a,i.skipFirst||u(),g.runDeferred(),r}function s(t){this.signal=t}function c(t,n){s.call(this,t),this.dispose=n}function a(){return"[data: "+i.peek(this)+"]"}function f(t){return g.runWithoutListening(t)}function h(t){g.ctx?g.deferred.push(t):t()}function d(t){if(!g.ctx)throw new Error("S.cleanup() must be called from within an S.formula.  Cannot call it at toplevel.");g.ctx.cleanups.push(t)}function l(t){if(!g.ctx)throw new Error("S.finalize() must be called from within an S.formula.  Cannot call it at toplevel.");g.ctx.finalizers.push(t)}function p(t){return JSON.stringify(t,function(t,n){return"function"==typeof n&&n.S?n():n})}var g=new t;return i.lift=r,i.data=u,i.formula=o,i.peek=f,i.defer=h,i.cleanup=d,i.finalize=l,i.toJSON=p,i.data.S=s,i.formula.S=c,c.prototype=new s,i}),t("schedulers",["S"],function(t){function n(t){return void 0!==t?s(t):function(t){var n=!1;return function(){n||(n=!0,s(function(){n=!1,t()}))}}}function e(t){return function(n){return function(){setTimeout(n,t)}}}function i(t){return function(n){var e=0,i=!1;return function(){if(!i){var r=Date.now();r-e>t?(e=r,n()):(i=!0,setTimeout(function(){e=Date.now(),i=!1,n()},t-(r-e)))}}}}function r(t){return function(n){var e=0,i=0;return function(){var r=Date.now();r>e&&(e=r,i&&clearTimeout(i),i=setTimeout(n,t))}}}function u(n){var e=[];return t.formula(function(){if(n()){for(var t=0;t<e.length;t++)e[t]();e=[]}}),function(t){return function(){e.push(t)}}}function o(n){var e=[];return t.formula(function(){if(n()){for(var t=0;t<e.length;t++)e[t]();e=[]}}),function(t){var n=!1;return function(){n||(n=!0,e.push(function(){n=!1,t()}))}}}var s=t.defer;return{defer:n,delay:e,throttle:i,debounce:r,pause:u,throttledPause:o}}),t("FormulaOptionBuilder",["S","schedulers"],function(t,n){function e(){this.options={sources:null,update:null,skipFirst:!1}}function i(t,n){return n?function(e){return t(n(e))}:t}function r(t,n){return t?t.concat(n):n}function u(t,n){t.options.update=i(n,t.options.update)}t.defer;t.on=function(){return(new e).on([].slice.call(arguments))},t.once=function(){return(new e).once()},t.defer=function(){return(new e).defer()},t.delay=function(t){return(new e).delay(t)},t.debounce=function(t){return(new e).debounce(t)},t.throttle=function(t){return(new e).throttle(t)},t.pause=function(t){return(new e).pause(t)},t.throttledPause=function(t){return(new e).throttledPause(t)},e.prototype={S:function(n){return t.formula(n,this.options)},on:function(t){return this.options.sources=r(this.options.sources,Array.isArray(t)?t:[].slice.call(arguments)),this},once:function(){return this.options.sources=[],this},skipFirst:function(){return this.options.skipFirst=!0,this},defer:function(){return u(this,n.defer()),this},delay:function(t){return u(this,n.delay(t)),this},debounce:function(t){return u(this,n.debounce(t)),this},throttle:function(t){return u(this,n.throttle(t)),this},pause:function(t){return u(this,n.pause(t)),this},throttledPause:function(t){return u(this,n.throttledPause(t)),this}}})});