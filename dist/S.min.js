!function(t){var n={};t(function(t,e,i){if(n.hasOwnProperty(t))throw new Error("define: cannot redefine module "+t);n[t]=i.apply(null,e.map(function(e){if(!n.hasOwnProperty(e))throw new Error("define: module "+e+" required by "+t+" has not been defined.");return n[e]}))}),"object"==typeof module&&"object"==typeof module.exports?module.exports=n.S:"function"==typeof define?define([],function(){return n.S}):this.S=n.S}(function(t){"use strict";t("graph",[],function(){function t(){this.nodeCount=0,this.updatingNode=null,this.freezeChangeset=null}function n(t,n,e){this.id=++t.nodeCount,this.node=n,this.region=e,this.active=!1,this.outbound=[]}function e(t,e,i){this.graph=t,this.payload=e,this.emitter=new n(t,this,i),this.value=void 0,this.gen=1,this.damage=0,this.listening=!0,this.pinning=!1,this.inbound=[],this.inboundIndex=[],this.cleanups=[],this.finalizers=[]}function i(t,n,e){this.from=t,this.to=n,this.boundary=e,this.active=!0,this.damaged=!1,this.gen=n.gen,this.outboundOffset=t.outbound.length,t.outbound.push(this),n.inbound.push(this),n.inboundIndex[t.id]=this}function o(){this.emitters=[],this.emitterIndex={}}return t.prototype={reportChange:function(t){if(this.freezeChangeset)return void this.freezeChangeset.add(t);t.damage();var n=this.updatingNode;this.updatingNode=null;try{t.repair()}catch(e){throw t.reset(),e}finally{this.updatingNode=n}},backtrack:function r(t){for(var n,e=this.updatingNode,i=-1,o=t.inbound.length;++i<o;)n=t.inbound[i],n&&n.damaged&&(n.from.node&&n.from.node.damage?r(n.from.node):n.from.repair());this.currentNode=e},freeze:function(t){if(this.freezeChangeset)return void t();var n=this.freezeChangeset=new o;try{t()}finally{this.freezeChangeset=null}this.flushChangeset(n)},addEdge:function(t){var n=this.updatingNode,e=null;n&&n.listening&&(e=n.inboundIndex[t.id],e?e.activate(t):e=new i(t,n,n.emitter.region&&t.region!==n.emitter.region))},addEntryPoint:function(){return new n(this,null,this.updatingNode?this.updatingNode.emitter.region:null)},addNode:function(t,n,i){var o,r,u=this.updatingNode,s=n.region||u&&u.emitter.region||null,a=new e(this,t,s);if(this.updatingNode=a,n.sources){for(o=-1,r=n.sources.length;++o<r;)n.sources[o]();a.listening=!1}if(u&&(u.pinning||n.pin?u.finalizers.push(i):u.cleanups.push(i)),!n.init||n.init(a.emitter)){a.emitter.active=!0;try{a.value=t()}catch(d){throw a.emitter.reset(),d}finally{a.emitter.active=!1,this.updatingNode=u}}else this.updatingNode=u;return a},addChangeset:function(){return new o},flushChangeset:function(t){var n,e,i;for(n=-1;++n<t.emitters.length;)t.emitters[n].damage();i=this.updatingNode,this.updatingNode=null,n=-1;try{for(;++n<t.emitters.length;)e=t.emitters[n],e.node&&e.node.update(),e.repair()}catch(o){for(n--;++n<t.emitters.length;)t.emitters[n].reset();throw o}finally{this.updatingNode=i}t.emitters=[],t.emitterIndex={}}},n.prototype={damage:function(){if(this.outbound){this.active=!0;for(var t,n,e=-1,i=this.outbound.length;++e<i;)if(t=this.outbound[e],t&&!t.damaged&&(!t.boundary||t.to.emitter.region(t.to.emitter))){if(n=t.to,n.emitter.active)throw new Error("circular dependency");t.damaged=!0,n.damage++,1===n.damage&&n.emitter.damage()}this.active=!1}},repair:function(){if(this.outbound){this.active=!0;for(var t,n,e=-1,i=this.outbound.length;++e<i;)t=this.outbound[e],t&&t.damaged&&(n=t.to,t.damaged=!1,n.damage--,0===n.damage&&(n.update(),n.emitter&&n.emitter.repair()));this.active=!1}},reset:function(){this.active=!1;for(var t,n,e=-1,i=this.outbound.length;++e<i;)t=this.outbound[e],t&&t.damaged&&(n=t.to,t.damaged=!1,n.damage=0,n.emitter.reset())},dispose:function(){this.node=null,this.outbound=null}},e.prototype={update:function(){var t,n,e;if(this.graph.updatingNode=this,this.cleanup(),this.gen++,this.value=this.payload(),this.listening&&this.inbound)for(t=-1,n=this.inbound.length;++t<n;)e=this.inbound[t],e.active&&e.gen<this.gen&&e.deactivate()},cleanup:function(){for(var t=-1,n=this.cleanups.length;++t<n;)this.cleanups[t]();this.cleanups=[]},dispose:function(){var t,n;for(this.cleanup(),t=-1,n=this.finalizers.length;++t<n;)this.finalizers[t]();for(t=-1,n=this.inbound.length;++t<n;)this.inbound[t].deactivate();this.graph=null,this.payload=null,this.inbound=null,this.inboundIndex=null,this.cleanups=null,this.finalizers=null,this.emitter.dispose(),this.emitter=null}},i.prototype={activate:function(t){this.active||(this.active=!0,t.outbound[this.outboundOffset]=this,this.from=t),this.gen=this.to.gen},deactivate:function(){this.active&&(this.active=!1,this.from.outbound&&(this.from.outbound[this.outboundOffset]=null),this.from=null)}},o.prototype={add:function(t){this.emitterIndex[t.id]||(this.emitters.push(t),this.emitterIndex[t.id]=t)}},t}),t("core",["graph"],function(t){function n(t){function n(n){return arguments.length>0?(t=n,l.reportChange(e)):l.addEdge(e),t}var e=l.addEntryPoint(null,null);return n.toJSON=o,n}function e(){this.sources=null,this.pin=!1,this.init=null,this.region=null}function i(t,n){function e(){return r?(l.addEdge(r.emitter),0!==r.damage&&l.backtrack(r),r.value):void 0}function i(){r&&(r.dispose(),r=void 0)}var r=l.addNode(t,n,i);return e.dispose=i,e.toJSON=o,e}function o(){return this()}function r(){function t(t){e.add(t)}function n(){l.flushChangeset(e)}var e=l.addChangeset();return t.go=n,t}function u(t){if(!l.updatingNode||!l.updatingNode.listening)return t();l.updatingNode.listening=!1;try{return t()}finally{l.updatingNode.listening=!0}}function s(t){if(!l.updatingNode||l.updatingNode.pinning)return t();l.updatingNode.pinning=!0;try{return t()}finally{l.updatingNode.pinning=!1}}function a(t){l.freeze(t)}function d(t){if(!l.updatingNode)throw new Error("S.cleanup() must be called from within an S.formula.  Cannot call it at toplevel.");l.updatingNode.cleanups.push(t)}function h(t){if(!l.updatingNode)throw new Error("S.finalize() must be called from within an S.formula.  Cannot call it at toplevel.");l.updatingNode.finalizers.push(t)}var l=new t;return{data:n,FormulaOptions:e,formula:i,region:r,freeze:a,peek:u,pin:s,cleanup:d,finalize:h}}),t("schedulers",["core"],function(t){function n(t){return t}function e(n){var e=t.region(),i=0;return function(t){var o=Date.now();e(t),o-i>n?(i=o,e.go()):setTimeout(function(){i=Date.now(),e.go()},n-(o-i))}}function i(n){var e=t.region(),i=0,o=0;return function(t){var r=Date.now();e(t),r>i&&(i=r,o&&clearTimeout(o),o=setTimeout(e.go,n))}}function o(t){var n=t.length;return function(){for(var e=-1;++e<n;)if(void 0===t[e]())return!1;return!0}}return{pause:n,throttle:e,debounce:i,when:o}}),t("options",["core","schedulers"],function(t,n){function e(){this.options=new t.FormulaOptions}function i(t,n){return t?t.concat(n):n}return e.prototype={on:function(t){return t=t?Array.isArray(t)?t:[t]:[],this.options.sources=i(this.options.sources,t),this},once:function(){return this.options.sources=[],this},pin:function(){return this.options.pin=!0,this},when:function(t){return t=t?Array.isArray(t)?t:[t]:[],this.options.sources=i(this.options.sources,t),this.options.region=this.options.init=n.when(t),this},defer:function(){return this}},"throttle debounce pause".split(" ").map(function(t){e.prototype[t]=function(e){return this.options.region=n[t](e),this}}),{FormulaOptionsBuilder:e}}),t("misc",[],function(){function t(t,n){return function(e){return 0!==arguments.length&&n(e),t()}}return{proxy:t}}),t("S",["core","options","schedulers","misc"],function(t,n,e,i){function o(n){var e,i;return arguments.length>1&&(e=n,i=Array.prototype.slice.call(arguments,1),n=function(){return e.apply(null,i)}),t.formula(n,new t.FormulaOptions)}return o.data=t.data,o.region=t.region,o.peek=t.peek,o.freeze=t.freeze,o.cleanup=t.cleanup,o.finalize=t.finalize,"on once when throttle debounce pause defer".split(" ").map(function(t){o[t]=function(e){return(new n.FormulaOptionsBuilder)[t](e)}}),o.pin=function(e){return 0===arguments.length?(new n.FormulaOptionsBuilder).pin():void t.pin(e)},n.FormulaOptionsBuilder.prototype.S=function(n){var e,i;return arguments.length>1&&(e=n,i=Array.prototype.slice.call(arguments,1),n=function(){return e.apply(null,i)}),t.formula(n,this.options)},o.proxy=i.proxy,o})});