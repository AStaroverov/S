!function(){function n(n){function r(){return S?(a(S),0!==S.marks&&f(S),S.payload.value):void 0}function l(){if(S){var n,t;for(d(z),n=-1,t=z.finalizers.length;++n<t;)z.finalizers[n]();for(z.fn=null,z.value=null,z.finalizers=null,z=null,n=-1,t=S.inbound.length;++n<t;)h(S.inbound[n]);S.payload=null,S.inbound=null,S.inboundIndex=null,S.outbound=null,S=null}}var s,p,v,m;arguments.length>1&&(s=n,p=Array.prototype.slice.call(arguments,1),n=function(){return s.apply(null,p)});var b=this instanceof i?this.options:new t,w=y,k=b.region||w&&w.region||null,z=new u(n),S=new e(++g,z,k);if(y=S,b.sources){for(v=-1,m=b.sources.length;++v<m;)b.sources[v]();z.listening=!1}if(w&&(w.payload.pinning||b.pin?w.payload.finalizers.push(l):w.payload.cleanups.push(l)),!b.init||b.init(S)){S.active=!0;try{S.payload.value=S.payload.fn()}catch(x){throw c(S),x}finally{S.active=!1,y=w}}else y=w;return r.dispose=l,r.toJSON=o,r}function t(){this.sources=null,this.pin=!1,this.init=null,this.region=null}function i(){this.options=new t}function o(){return this()}function e(n,t,i){this.id=n,this.payload=t,this.region=i,this.marks=0,this.active=!1,this.inbound=[],this.inboundIndex=[],this.outbound=[]}function r(n,t,i){this.from=n,this.to=t,this.boundary=i,this.active=!0,this.damaged=!1,this.gen=t.payload.gen,this.outboundOffset=n.outbound.length,n.outbound.push(this),t.inbound.push(this),t.inboundIndex[n.id]=this}function u(n){this.fn=n,this.gen=1,this.value=void 0,this.listening=!0,this.pinning=!1,this.cleanups=[],this.finalizers=[]}function a(n){var t=y,i=null;t&&t.payload.listening&&(i=t.inboundIndex[n.id],i?p(i):new r(n,t,t.region&&n.region!==t.region))}function l(n){n.active=!0;for(var t,i,o=-1,e=n.outbound.length;++o<e;)if(t=n.outbound[o],t&&!t.marked&&(!t.boundary||t.to.region(t.to))){if(i=t.to,i.active)throw new Error("circular dependency");t.marked=!0,i.marks++,1===i.marks&&l(i)}n.active=!1}function s(n){var t,i,o,e,r;if(n.active=!0,n.payload&&(r=n.payload,y=n,d(r),r.gen++,r.value=r.fn(),r.listening&&n.inbound))for(t=-1,i=n.inbound.length;++t<i;)o=n.inbound[t],o.active&&o.gen<r.gen&&h(o);for(t=-1,i=n.outbound.length;++t<i;)o=n.outbound[t],o&&o.marked&&(e=o.to,o.marked=!1,e.marks--,0===e.marks&&s(e));n.active=!1}function f(n){for(var t,i=y,o=-1,e=n.inbound.length;++o<e;)t=n.inbound[o],t&&t.marked&&(t.from.marked?f(t.from):s(t.from));y=i}function c(n){n.active=!1;for(var t,i,o=-1,e=n.outbound.length;++o<e;)t=n.outbound[o],t&&t.damaged&&(i=t.to,t.damaged=!1,i.damage=0,c(i))}function d(n){for(var t=-1,i=n.cleanups.length;++t<i;)n.cleanups[t]();n.cleanups=[]}function p(n){n.active||(n.active=!0,from.outbound[n.outboundOffset]=n,n.from=from),n.gen=n.to.payload.gen}function h(n){n.active=!1,n.from.outbound&&(n.from.outbound[n.outboundOffset]=null),n.from=null}"object"==typeof module&&"object"==typeof module.exports?module.exports=n:"function"==typeof define?define([],function(){return n}):this.S=n;var g=0,y=null,v=null;n.data=function b(n){function b(i){var o;if(arguments.length>0)if(n=i,v)v(t);else{l(t),o=y,y=null;try{s(t)}catch(e){throw c(t),e}finally{y=o}}else a(t);return n}var t=new e(++g,null,y?y.region:null);return b.toJSON=o,b},i.prototype={on:function(){return this.options.sources=Array.prototype.slice.apply(arguments),this},once:function(){return this.options.sources=[],this},pin:function(){return this.options.pin=!0,this},defer:function(){return this},throttle:function(t){var i=n.region(),o=0;return this.options.region=function(n){var e=Date.now();i(n),e-o>t?(o=e,i.go()):setTimeout(function(){o=Date.now(),i.go()},t-(e-o))},this},debounce:function(t){var i=n.region(),o=0,e=0;return this.options.region=function(n){var r=Date.now();i(n),r>o&&(o=r,e&&clearTimeout(e),e=setTimeout(i.go,t))},this},pause:function(n){return this.options.region=n,this},when:function(){var n=Array.prototype.slice.apply(arguments);return len=n.length,this.options.sources=n,this.options.region=this.options.init=function(){for(var t=-1;++t<len;)if(void 0===n[t]())return!1;return!0},this}};for(var m in i.prototype)n[m]=function(n){return function(){var t=new i;return t[n].apply(t,arguments)}}(m);i.prototype.S=n,n.region=function w(){function w(n){i[n.id]||(t.push(n),i[n.id]=n)}function n(){var n,o;for(n=-1;++n<t.length;)l(t[n]);o=y,y=null,n=-1;try{for(;++n<t.length;)s(t[n])}catch(e){for(n--;++n<t.length;)c(t[n]);throw e}finally{y=o}t=[],i={}}var t=[],i={};return w.go=n,w},n.peek=function(n){if(!y||!y.payload.listening)return n();y.payload.listening=!1;try{return n()}finally{y.payload.listening=!0}},n.pin=function(n){if(0===arguments.length)return(new i).pin();if(!y||y.payload.pinning)return n();y.payload.pinning=!0;try{return n()}finally{y.payload.pinning=!1}},n.cleanup=function(n){if(!y)throw new Error("S.cleanup() must be called from within an S.formula.  Cannot call it at toplevel.");y.payload.cleanups.push(n)},n.finalize=function(n){if(!y)throw new Error("S.finalize() must be called from within an S.formula.  Cannot call it at toplevel.");y.payload.finalizers.push(n)},n.freeze=function k(t){if(v)t();else{var k=v=n.region();try{t()}finally{v=null}k.go()}}}();