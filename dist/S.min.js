!function(t){var n={};t(function(t,e,i){if(n.hasOwnProperty(t))throw new Error("define: cannot redefine module "+t);n[t]=i.apply(null,e.map(function(e){if(!n.hasOwnProperty(e))throw new Error("define: module "+e+" required by "+t+" has not been defined.");return n[e]}))}),"object"==typeof module&&"object"==typeof module.exports?module.exports=n.S:"function"==typeof define?define([],function(){return n.S}):this.S=n.S}(function(t){"use strict";t("graph",[],function(){function t(){this.nodeCount=0,this.updatingNode=null,this.deferredEmitters=null,this.deferredEmittersIndex=null}function n(t,n,e){this.id=++t.nodeCount,this.node=n,this.region=e,this.active=!1,this.outbound=[]}function e(t,e,i){this.graph=t,this.payload=e,this.emitter=new n(t,this,i),this.value=void 0,this.gen=1,this.damage=0,this.listening=!0,this.pinning=!1,this.inbound=[],this.inboundIndex=[],this.cleanups=[],this.finalizers=[]}function i(t,n){this.from=t,this.to=n,this.active=!0,this.boundary=null,this.damaged=!1,this.gen=n.gen,this.outboundOffset=t.outbound.length,t.outbound.push(this),n.inbound.push(this),n.inboundIndex[t.id]=this}function o(){this.nodes=[],this.nodesIndex=[]}function s(t){this.id=t.count++,this.lineage=t.target?t.target.lineage:[],this.updates=[]}function r(t,n,e){var i,o,s;for(this.lineage=e.target?e.target.lineage.slice(0):[],this.lineage.push(this),this.scheduler=n.update,this.listening=!0,this.pinning=n.pinning||!1,this.locked=!0,this.gen=1,this.dependencies=[],this.dependenciesIndex={},this.cleanups=[],this.finalizers=[],this.updaters=new Array(this.lineage.length+1),this.updaters[this.lineage.length]=t,i=this.lineage.length-1;i>=0;i--)o=this.lineage[i],o.scheduler&&(t=o.scheduler(t)),this.updaters[i]=t;if(n.sources){s=e.target,e.target=this,this.locked=!1;try{for(i=0;i<n.sources.length;i++)n.sources[i]()}finally{this.locked=!0,e.target=s}this.listening=!1}}function u(t,n){this.active=!0,this.gen=t.gen,this.updates=n.updates,this.offset=n.updates.length;for(var e=0,i=Math.min(t.lineage.length,n.lineage.length);i>e&&t.lineage[e]===n.lineage[e];e++);this.update=t.updaters[e],this.updates.push(this.update),t.dependencies.push(this),t.dependenciesIndex[n.id]=this}return t.prototype={reportChange:function(t){if(this.deferredEmitters)return void(this.deferredEmittersIndex[t.id]||(this.deferredEmitters.push(t),this.deferredEmittersIndex[t.id]=t));t.damage();var n=this.updatingNode;this.updatingNode=null;try{t.repair()}catch(e){throw t.reset(),e}finally{this.updatingNode=n}},repair:function a(t){for(var n,e=this.updatingNode,i=-1,o=t.inbound.length;++i<o;)n=t.inbound[i],n&&n.damaged&&(n.from.node&&n.from.node.damage?a(n.from.node):n.from.repair());this.currentNode=e},freeze:function(t){var n,e,i,o;if(this.deferredEmitters)return void t();this.deferredEmitters=n=[],this.deferredEmittersIndex={};try{t()}finally{this.deferredEmitters=null,this.deferredEmittersIndex=null}for(i=-1,o=n.length;++i<o;)n[i].damage();e=this.updatingNode,this.updatingNode=null,i=-1;try{for(;++i<o;)n[i].repair()}catch(s){for(i=-1;++i<o;)n[i].reset();throw s}finally{this.updatingNode=e}},addEdge:function(t){var n=this.updatingNode,e=null;n&&n.listening&&(e=n.inboundIndex[t.id],e?e.activate(t):e=new i(t,n))},addEntryPoint:function(){return new n(this,null)},addNode:function(t,n,i){var o,s,r,u=new e(this,t,n);if(r=this.updatingNode,this.updatingNode=u,n.sources){for(o=-1,s=n.sources.length;++o<s;)n.sources[o]();u.listening=!1}r&&(r.pinning||n.pin?r.finalizers.push(i):r.cleanups.push(i)),u.emitter.active=!0;try{u.value=t()}catch(a){throw u.emitter.reset(),a}finally{u.emitter.active=!1,this.updatingNode=r}return u}},n.prototype={damage:function(){this.active=!0;for(var t,n=-1,e=this.outbound.length;++n<e;)if(t=this.outbound[n],!(!t||t.damaged||t.boundary&&t.boundary())){if(t.to.emitter.active)throw new Error("circular dependency");t.damaged=!0,t.to.damage++,1===t.to.damage&&t.to.emitter.damage()}this.active=!1},repair:function(){this.active=!0;for(var t,n=-1,e=this.outbound.length;++n<e;)t=this.outbound[n],t&&t.damaged&&(t.damaged=!1,t.to.damage--,0===t.to.damage&&(t.to.update(),t.to.emitter.repair()));this.active=!1},reset:function(){this.active=!1;for(var t,n=-1,e=this.outbound.length;++n<e;)t=this.outbound[n],t&&t.damaged&&(t.damaged=!1,t.to.damage=0,t.to.emitter.reset())},dispose:function(){this.node=null,this.outbound=null}},e.prototype={update:function(){var t,n,e;if(this.graph.updatingNode=this,this.cleanup(),this.gen++,this.value=this.payload(),this.listening)for(t=-1,n=this.inbound.length;++t<n;)e=this.inbound[t],e.active&&e.gen<this.gen&&e.deactivate()},cleanup:function(){for(var t=-1,n=this.cleanups.length;++t<n;)this.cleanups[t]();this.cleanups=[]},dispose:function(){var t,n;for(this.cleanup(),t=-1,n=this.finalizers.length;++t<n;)this.finalizers[t]();for(t=-1,n=this.inbound.length;++t<n;)this.inbound[t].deactivate();this.graph=null,this.payload=null,this.inbound=null,this.inboundIndex=null,this.cleanups=null,this.finalizers=null,this.emitter.dispose()}},i.prototype={activate:function(t){this.active||(this.active=!0,t.outbound[this.outboundOffset]=this,this.from=t),this.gen=this.to.gen},deactivate:function(){this.active&&(this.active=!1,this.from.outbound&&(this.from.outbound[this.outboundOffset]=null),this.from=null)}},o.prototype={add:function(){},go:function(){}},s.prototype={propagate:function(){var t,n,e=this.updates,i=e.length;for(t=0;i>t;t++)n=e[t],n&&n()},dispose:function(){this.lineage=null,this.updates.length=0}},r.prototype={beginUpdate:function(){this.cleanup(),this.gen++},endUpdate:function(){if(this.listening){var t,n;for(t=0;t<this.dependencies.length;t++)n=this.dependencies[t],n.active&&n.gen<this.gen&&n.deactivate()}},addSubformula:function(t,n){if(this.locked)throw new Error("Cannot create a new subformula except while updating the parent");(n||this.pinning?this.finalizers:this.cleanups).push(t)},addSource:function(t){if(this.listening&&!this.locked){var n=this.dependenciesIndex[t.id];n?n.activate(this.gen,t):new u(this,t)}},cleanup:function(){for(var t=0;t<this.cleanups.length;t++)this.cleanups[t]();this.cleanups=[]},dispose:function(){var t;for(this.cleanup(),t=0;t<this.finalizers.length;t++)this.finalizers[t]();for(t=this.dependencies.length-1;t>=0;t--)this.dependencies[t].deactivate();this.lineage=null,this.scheduler=null,this.updaters=null,this.cleanups=null,this.finalizers=null,this.dependencies=null,this.dependenciesIndex=null}},u.prototype={activate:function(t,n){this.active||(this.active=!0,this.updates=n.updates,this.updates[this.offset]=this.update),this.gen=t},deactivate:function(){this.active&&(this.updates[this.offset]=null,this.updates=null),this.active=!1}},{Graph:t,Node:e,Edge:i}}),t("core",["graph"],function(t){function n(n){function e(e){return arguments.length>0?(n=e,t.reportChange(i)):t.addEdge(i),n}var i=t.addEntryPoint(null,null);return e.toJSON=o,e}function e(){this.sources=null,this.pin=!1,this.boundary=null}function i(n,e){function i(){return r?(t.addEdge(r.emitter),0!==r.damage&&t.repair(r),r.value):void 0}function s(){r&&(r.dispose(),r=void 0)}var r=t.addNode(n,e,s);return i.dispose=s,i.toJSON=o,i}function o(){return this()}function s(n){if(!t.updatingNode||!t.updatingNode.listening)return n();t.updatingNode.listening=!1;try{return n()}finally{t.updatingNode.listening=!0}}function r(n){if(!t.updatingNode||t.updatingNode.pinning)return n();t.updatingNode.pinning=!0;try{return n()}finally{t.updatingNode.pinning=!1}}function u(n){t.freeze(n)}function a(n){if(!t.updatingNode)throw new Error("S.cleanup() must be called from within an S.formula.  Cannot call it at toplevel.");t.updatingNode.cleanups.push(n)}function d(n){if(!t.updatingNode)throw new Error("S.finalize() must be called from within an S.formula.  Cannot call it at toplevel.");t.updatingNode.finalizers.push(n)}var t=new t.Graph;return{data:n,FormulaOptions:e,formula:i,freeze:u,peek:s,pin:r,cleanup:a,finalize:d}}),t("schedulers",["core"],function(t){function n(){return function(){}}function e(t){return function(n){var e=!1;return function(){e||(e=!0,t(function(){e=!1,n()}))}}}function i(){return e(t.defer)}function o(t){return function(n){var e=0,i=!1;return function(){if(!i){var o=Date.now();o-e>t?(e=o,n()):(i=!0,setTimeout(function(){e=Date.now(),i=!1,n()},t-(o-e)))}}}}function s(t){return function(n){var e=0,i=0;return function(){var o=Date.now();o>e&&(e=o,i&&clearTimeout(i),i=setTimeout(function(){n()},t))}}}function r(){function t(t){e.push(t)}function n(){for(var t=0;t<e.length;t++)e[t]();e=[]}var e=[];return t.go=n,t}function u(t){var n=t.length;return function(){for(var e=-1;++e<n;)if(void 0===t[e]())return!0;return!1}}return{stop:n,pause:e,defer:i,throttle:o,debounce:s,stopsign:r,when:u}}),t("options",["core","schedulers"],function(t,n){function e(){this.options=new t.FormulaOptions}function i(t,n){return n?function(){return t(n())}:t}function o(t,n){return t?t.concat(n):n}function s(t,n){t.options.update=i(n,t.options.update)}return e.prototype={on:function(t){return t=t?Array.isArray(t)?t:[t]:[],this.options.sources=o(this.options.sources,t),this},once:function(){return this.options.sources=[],this},pin:function(){return this.options.pin=!0,this},when:function(t){return t=t?Array.isArray(t)?t:[t]:[],this.options.sources=o(this.options.sources,t),this.options.boundary=n.when(t),this}},"defer throttle debounce pause".split(" ").map(function(t){e.prototype[t]=function(e){return s(this,n[t](e)),this}}),{FormulaOptionsBuilder:e}}),t("misc",[],function(){function t(t,n){return function(e){return 0!==arguments.length&&n(e),t()}}return{proxy:t}}),t("S",["core","options","schedulers","misc"],function(t,n,e,i){function o(n){var e,i;return arguments.length>1&&(e=n,i=Array.prototype.slice.call(arguments,1),n=function(){return e.apply(null,i)}),t.formula(n,new t.FormulaOptions)}return o.data=t.data,o.peek=t.peek,o.cleanup=t.cleanup,o.finalize=t.finalize,"on once when defer throttle debounce pause".split(" ").map(function(t){o[t]=function(e){return(new n.FormulaOptionsBuilder)[t](e)}}),o.pin=function(e){return 0===arguments.length?(new n.FormulaOptionsBuilder).pin():void t.pin(e)},n.FormulaOptionsBuilder.prototype.S=function(n){var e,i;return arguments.length>1&&(e=n,i=Array.prototype.slice.call(arguments,1),n=function(){return e.apply(null,i)}),t.formula(n,this.options)},o.stopsign=e.stopsign,o.proxy=i.proxy,o})});