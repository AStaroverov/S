!function(){"use strict";function n(n){function t(){e=E+1,S?A.add(r):i(r)}var e=0,r=new w(null),o=n(t);return function(){return E!==e&&(o&&o(),u(r,this),!0)}}function t(n){return function(){for(var t=0;t<n.length;t++)n[t]()}}function e(n,t){var e=t.id,u=n.nodes[e];u!==t&&(u!==k&&(n.ids[n.count++]=e),n.nodes[e]=t,t.sources[t.count++]=n)}function u(n,t){n.log||(n.log=new m),e(n.log,t)}function r(n,t){n.log||(n.log=new m),e(n.log,t)}function i(n){try{l(n)}finally{S=!1,b=null,j=!1,x=!1}}function o(n){try{n.value=n.fn(n.value),A.count>0&&l(null)}finally{S=!1,b=null,j=!1,x=!1}}function l(n){var t,e=0;for(S=!0,C.reset(),R.reset(),n&&(A.reset(),E++,c(n),C.run(s),R.run(d));0!==A.count;)if(t=A,A=z,z=t,A.reset(),E++,t.run(c),C.run(s),R.run(d),e++>1e5)throw new Error("Runaway frames detected")}function c(n){n.value=n.pending,n.pending=B,n.log&&f(n.log)}function f(n){for(var t=n.nodes,e=n.ids,u=0,r=0;r<n.count;r++){var i=e[r],o=t[i];o===k?(t[i]=q,u++):(o.age<E&&(o.age=E,o.hold&&o.hold()?o.state=D:(o.state=F,C.add(o),o.children&&a(o.children),o.log&&f(o.log))),u&&(e[r-u]=i))}u&&(n.count-=u)}function a(n){for(var t=0;t<n.length;t++){var e=n[t];e.age=E,e.state=D,e.children&&a(e.children)}}function s(n){if(n.state===F){var t=b,e=j;b=n,j=!1,n.state=G,h(n,!1),n.value=n.fn(n.value),n.state=D,b=t,j=e}}function h(n,t){var e=n.sources,u=n.cleanups,r=n.children;if(u){for(var i=0;i<u.length;i++)u[i](t);n.cleanups=null}if(r){for(var i=0;i<r.length;i++)d(r[i]);n.children=null}for(var i=0;i<n.count;i++)e[i].nodes[n.id]=k,e[i]=null;n.count=0}function d(n){n.fn=null,n.hold=null,n.log=null,h(n,!0),n.sources=null}var p=function(t,e){var u=b,i=j,l=this instanceof v?this:null,c=l&&l._defer?n(l._defer):u?u.hold:null,f=l&&l._orphan,a=new y(t,e,c);return b=a,j=!1,S?a.value=a.fn(a.value):(S=!0,A.reset(),o(a)),u&&!f&&(u.children||(u.children=[])).push(a),b=u,j=i,function(){if(x)b?R.add(a):d(a);else if(b){if(a.age===E){if(a.state===G)throw new Error("circular dependency");s(a)}j||r(a,b)}return a.value}};p.on=function H(n,e,u,r){function H(t){return n(),r?r=!1:(j=!0,t=e(t),j=!1),t}return Array.isArray(n)&&(n=t(n)),r=!!r,this instanceof v?this.S(H,u):p(H,u)};var v=function(){function n(n,t,e){this._orphan=t,this._defer=e,this._defer=e||n&&n._defer,this._orphan=t||n&&n._orphan}return n.prototype.defer=function(t){return new n(this,(!1),t)},n}();v.prototype.S=p,v.prototype.on=p.on;var g=new v(null,(!0),null);p.orphan=function(){return g},p.defer=function(n){return new v(null,(!1),n)},p.data=function(n){var t=new w(n);return function(n){if(arguments.length>0){if(S)if(t.pending!==B){if(n!==t.pending)throw new Error("conflicting changes: "+n+" !== "+t.pending)}else t.pending=n,A.add(t);else t.log?(t.pending=n,i(t)):t.value=n;return n}return b&&!j&&u(t,b),t.value}},p.value=function(n,t){var e=p.data(n),u=0;return function r(i){if(0===arguments.length)return e();var o=t?t(n,i):n===i;if(!o){if(u===E)throw new Error("conflicting values: "+r+" is not the same as "+n);u=E,n=i,e(i)}return i}},p.sum=function(n){var t=new w(n);return function(e){return arguments.length>0?(S?t.pending!==B?t.pending=e(t.pending):(t.pending=e(t.value),A.add(t)):t.log?(t.pending=e(t.value),i(t)):t.value=e(t.value),n):(b&&!j&&u(t,b),t.value)}},p.freeze=function(n){var t;if(S)t=n();else{S=!0,A.reset();try{t=n(),i(null)}finally{S=!1}}return t},p.sample=function(n){var t;return b&&!j?(j=!0,t=n(),j=!1):t=n(),t},p.dispose=function(n){if(x)n();else{x=!0;try{n()}finally{x=!1}}},p.cleanup=function(n){if(!b)throw new Error("S.cleanup() must be called from within an S() computation.  Cannot call it at toplevel.");(b.cleanups||(b.cleanups=[])).push(n)};var w=function(){function n(n){this.value=n,this.pending=B,this.log=null}return n}(),y=function(){function n(t,e,u){this.fn=t,this.value=e,this.hold=u,this.id=n.count++,this.age=E,this.state=D,this.count=0,this.sources=[],this.log=null,this.children=null,this.cleanups=null}return n.count=0,n}(),m=function(){function n(){this.count=0,this.nodes=[],this.ids=[]}return n}(),_=function(){function n(){this.items=[],this.count=0}return n.prototype.reset=function(){this.count=0},n.prototype.add=function(n){this.items[this.count++]=n},n.prototype.run=function(n){for(var t=this.items,e=this.count,u=0;u<e;u++)n(t[u]),t[u]=null;this.count=0},n}(),E=1,S=!1,b=null,j=!1,x=!1,A=new _,z=new _,C=new _,R=new _,k=new y(null,null,null),q=new y(null,null,null),B={},D=0,F=1,G=2;"object"==typeof module&&"object"==typeof module.exports?module.exports=p:"function"==typeof define?define([],function(){return p}):(eval||function(){})("this").S=p}();