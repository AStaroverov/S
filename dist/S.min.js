!function(t){var n={};t(function(t,e,i){if(n.hasOwnProperty(t))throw new Error("define: cannot redefine module "+t);n[t]=i.apply(null,e.map(function(e){if(!n.hasOwnProperty(e))throw new Error("define: module "+e+" required by "+t+" has not been defined.");return n[e]}))}),"object"==typeof module&&"object"==typeof module.exports?module.exports=n.S:"function"==typeof define?define([],function(){return n.S}):this.S=n.S}(function(t){"use strict";t("Source",[],function(){function t(t){this.id=t.count++,this.lineage=t.ctx?t.ctx.lineage:[],this.updates=[]}return t.prototype={propagate:function(){var t,n,e=this.updates;for(t=0;t<e.length;t++)n=e[t],n&&n()}},t}),t("Dependency",[],function(){function t(t,n){this.active=!0,this.gen=t.gen,this.updates=n.updates,this.offset=n.updates.length;for(var e=0,i=Math.min(t.lineage.length,n.lineage.length);i>e&&t.lineage[e]===n.lineage[e];e++);this.update=t.updaters[e],this.updates.push(this.update),t.dependencies.push(this),t.dependenciesIndex[n.id]=this}return t.prototype={activate:function(t){this.active||(this.active=!0,this.updates[this.offset]=this.update),this.gen=t},deactivate:function(){this.active&&(this.updates[this.offset]=null),this.active=!1}},t}),t("Context",["Dependency"],function(t){function n(t,n,e){var i,o;for(this.lineage=e.ctx?e.ctx.lineage.slice(0):[],this.lineage.push(this),this.mod=n.update,this.updaters=[],i=this.lineage.length-1;i>=0;i--)o=this.lineage[i],o.mod&&(t=o.mod(t)),this.updaters[i]=t;this.updating=!1,this.listening=!0,this.gen=1,this.dependencies=[],this.dependenciesIndex={},this.cleanups=[],this.finalizers=[],n.sources&&(e.runInContext(function(){for(var t=0;t<n.sources.length;t++)n.sources[t]()},void 0,this),this.listening=!1)}return n.prototype={beginUpdate:function(){this.cleanup(),this.gen++,this.updating=!0},endUpdate:function(){if(this.updating=!1,this.listening){var t,n;for(t=0;t<this.dependencies.length;t++)n=this.dependencies[t],n.active&&n.gen<this.gen&&n.deactivate()}},addSource:function(n){if(this.listening){var e=this.dependenciesIndex[n.id];e?e.activate(this.gen):new t(this,n)}},addChild:function(t){this.cleanups.push(t)},cleanup:function(){for(var t=0;t<this.cleanups.length;t++)this.cleanups[t]();this.cleanups=[]},dispose:function(){var t;for(t=0;t<this.finalizers.length;t++)this.finalizers[t]();for(t=this.dependencies.length-1;t>=0;t--)this.dependencies[t].deactivate()}},n}),t("Environment",[],function(){function t(){this.count=1,this.toplevel=!0,this.ctx=null,this.deferred=[]}return t.prototype={runInContext:function(t,n,e){if(!e.updating){var i,o,r;i=this.ctx,this.ctx=e,r=this.toplevel,this.toplevel=!1,e.beginUpdate();try{o=void 0===n?t():t(n)}finally{this.ctx=i,this.toplevel=r}return e.endUpdate(),o}},runWithoutListening:function(t){var n;this.ctx&&(n=this.ctx.listening,this.ctx.listening=!1);try{return t()}finally{this.ctx&&(this.ctx.listening=n)}},runDeferred:function(){if(this.toplevel)for(;0!==this.deferred.length;)this.deferred.shift()()}},t}),t("S",["Environment","Source","Context"],function(t,n,e){function i(t,n){return i.lift(t,n)}function o(t,n){return"function"==typeof t?u(t,n):t instanceof Array?i.seq(t):r(t)}function r(t){function e(n){if(arguments.length>0){if(void 0===n)throw new Error("S.data can't be set to undefined.  In S, undefined is reserved for namespace lookup failures.");t=n,o.propagate(),l.runDeferred()}else l.ctx&&l.ctx.addSource(o);return t}if(void 0===t)throw new Error("S.data can't be initialized with undefined.  In S, undefined is reserved for namespace lookup failures.");var o=new n(l);return e.pipe=i.data.pipe,e.toString=s,e}function u(t,o){function r(){return l.ctx&&l.ctx.addSource(p),a}function u(t){l.runInContext(s,t,d)}function s(n){var e=void 0===n?t():t(n);void 0!==e&&(a=e,l.ctx=null,p.propagate())}function f(){d.cleanup(),d.dispose()}function c(){return"[formula: "+(void 0!==a?a+" - ":"")+t+"]"}o=o||{};var a,p=new n(l),d=new e(u,o,l);return l.ctx&&l.ctx.addChild(f),r.pipe=i.formula.pipe,r.dispose=f,r.toString=c,(o.init?o.init(u):u)(),l.runDeferred(),r}function s(){return"[data: "+i.peek(this)+"]"}function f(t){return l.runWithoutListening(t)}function c(t){l.toplevel?t():l.deferred.push(t)}function a(t){if(!l.ctx)throw new Error("S.cleanup() must be called from within an S.formula.  Cannot call it at toplevel.");l.ctx.cleanups.push(t)}function p(t){if(!l.ctx)throw new Error("S.finalize() must be called from within an S.formula.  Cannot call it at toplevel.");l.ctx.finalizers.push(t)}function d(t,n){return function(e){return 0!==arguments.length&&n(e),t()}}function h(t){return JSON.stringify(t,function(t,n){return"function"==typeof n&&n.S?n():n})}var l=new t;return i.lift=o,i.data=r,i.formula=u,i.peek=f,i.defer=c,i.proxy=d,i.cleanup=a,i.finalize=p,i.toJSON=h,i.data.pipe=null,i.formula.pipe=null,i}),t("modifiers",["S"],function(t){function n(){return function(){}}function e(t){return void 0!==t?l(t):function(t){return function(n){l(function(){t(n)})}}}function i(){return function(t){var n=!1,e=void 0;return function(i){e=i,n||(n=!0,l(function(){n=!1,t(e)}))}}}function o(t){return function(n){return function(e){setTimeout(n,t,e)}}}function r(t){return function(n){var e=!1,i=void 0;return function(o){i=o,e||(e=!0,setTimeout(function(){e=!1,n(i)},t))}}}function u(t){return function(n){var e=0;return function(i){var o=Date.now();e+=t,o>=e?(e=o,n(i)):setTimeout(n,e-o,i)}}}function s(t){return function(n){var e=0,i=void 0,o=!1;return function(r){if(i=r,!o){var u=Date.now();u-e>t?(e=u,n(r)):(o=!0,setTimeout(function(){e=Date.now(),o=!1,n(i)},t-(u-e)))}}}}function f(t){return function(n){var e=0,i=void 0,o=0;return function(r){i=r;var u=Date.now();u>e&&(e=u,o&&clearTimeout(o),o=setTimeout(function(){n(i)},t))}}}function c(n){var e,i=[];return t.on(n).S(function(){for(;!(e=n())&&i.length;){var t=i.shift();t()}}),function(t){return function(n){e?i.push(function(){t(n)}):t(n)}}}function a(n){var e,i=[];return t.on(n).S(function(){for(;!(e=n())&&i.length;){var t=i.shift();t()}}),function(t){var n=!1,o=void 0;return function(r){if(e){if(o=r,n)return;n=!0,i.push(function(){n=!1,t(o)})}else t(r)}}}function p(t){return function(n){return function(e){n(void 0===e?t():t(e))}}}function d(t){return function(n){return function(e){(void 0===e?t():t(e))&&n(e)}}}function h(t){return t=t||function(t,n){return t===n},function(n){var e=void 0;return function(i){var o=!t(i,e);e=i,o&&n(i)}}}var l=t.defer;return{stop:n,defer:e,defer1:i,delay:o,delay1:r,throttle:u,throttle1:s,debounce1:f,pause:c,pause1:a,map:p,filter:d,changes:h}}),t("FormulaOptionBuilder",["S","modifiers"],function(t,n){function e(){this.options={sources:null,update:null,init:null}}function i(t,n){return n?function(e){return t(n(e))}:t}function o(t,n){return t?t.concat(n):n}function r(t,n){t.options.update=i(n,t.options.update)}function u(t,n){t.options.init=i(n,t.options.init)}e.prototype={S:function(n){return t.formula(n,this.options)},on:function(t){return t=t?Array.isArray(t)?t:[t]:[],this.options.sources=o(this.options.sources,t),this},once:function(){return this.options.sources=[],this},skipFirst:function(){if(null===this.options.sources||0===this.options.sources.length)throw new Error("to use skipFirst, you must first have specified at least one dependency with .on(...)");return u(this,n.stop),this}},"defer defer1 delay delay1 throttle throttle1 debounce1 pause pause1 filter".split(" ").map(function(t){e.prototype[t]=function(e){return r(this,n[t](e)),this}}),"on once defer defer1 delay delay1 throttle throttle1 debounce1 pause pause1 filter".split(" ").map(function(n){t[n]=function(t){return(new e)[n](t)}})}),t("Transformers",["S","modifiers"],function(t,n){function e(t){var e=n.map(t);this.signal=t,this.options={sources:[t],update:e,init:e}}function i(t){e.call(this,t)}function o(t,n){return n?function(e){return t(n(e))}:t}function r(t,n){t.options.update=o(n,t.options.update)}function u(t,n){t.options.init=o(n,t.options.init)}function s(t){return t}t.data.pipe=function(){return new e(this)},t.formula.pipe=function(){return new i(this)},e.prototype={S:function(n){return t.proxy(t.formula(n||s,this.options),this.signal)}},i.prototype=new e,i.prototype.S=function(n){return t.formula(n||s,this.options)},"defer defer1 delay delay1 throttle throttle1 debounce1 pause pause1 map filter changes".split(" ").map(function(t){e.prototype[t]=function(e){return r(this,n[t](e)),this}}),e.prototype.map=function(t){var e=n.map(t);return u(this,e),r(this,e),this}})});