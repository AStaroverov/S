!function(){"use strict";function n(n){function t(){return z&&(a(z),0!==z.marks&&d(z,b),z)?z.payload.value:void 0}function u(){if(!S){S=!0;var n,t;for(n=-1,t=z.inbound.length;++n<t;)y(z.inbound[n]);for(h(k),n=-1,t=k.finalizers.length;++n<t;)k.finalizers[n]();k.fn=null,k.value=null,k.finalizers=null,k=null,z.payload=null,z.inbound=null,z.inboundIndex=null,z.outbound=null,z=null}}var s,f,c,p;arguments.length>1&&(s=n,f=Array.prototype.slice.call(arguments,1),n=function(){return s.apply(null,f)});var g=this instanceof i?this.options:new o,v=b,w=g.region||v&&v.region||null,k=new l(n),z=new e(++m,k,w),S=!1;if(b=z,g.sources){for(c=-1,p=g.sources.length;++c<p;)try{g.sources[c]()}catch(x){throw b=v,x}k.listening=!1}v&&(v.payload.pinning||g.pin?v.payload.finalizers.push(u):v.payload.cleanups.push(u)),z.trigger=v||z;try{(!g.init||g.init(z))&&(z.payload.value=n())}finally{z.trigger=null,b=v}return t.dispose=u,t.toJSON=r,t}function t(n){var t;if(v)v(n);else{s(n),t=b,b=null;try{f(n,t||n)}catch(o){throw c(n),o}finally{b=t}}}function o(){this.sources=null,this.pin=!1,this.init=null,this.region=null}function i(){this.options=new o}function r(){return this()}function e(n,t,o){this.id=n,this.payload=t,this.region=o,this.marks=0,this.trigger=null,this.cur=0,this.inbound=[],this.inboundIndex=[],this.outbound=[]}function u(n,t,o){this.from=n,this.to=t,this.boundary=o,this.active=!0,this.marked=!1,this.gen=t.payload.gen,this.outboundOffset=n.outbound.length,n.outbound.push(this),t.inbound.push(this),t.inboundIndex[n.id]=this}function l(n){this.fn=n,this.gen=1,this.value=void 0,this.listening=!0,this.pinning=!1,this.cleanups=[],this.finalizers=[]}function a(n){var t=b,o=null;t&&t.payload&&t.payload.listening&&(o=t.inboundIndex[n.id],o?g(o,n):new u(n,t,t.region&&n.region!==t.region))}function s(n){n.trigger=n;for(var t,o,i=-1,r=n.outbound.length;++i<r;)if(t=n.outbound[i],t&&!t.marked&&(!t.boundary||t.to.region(t.to))){if(o=t.to,o.trigger)throw new Error("circular dependency");t.marked=!0,o.marks++,1===o.marks&&s(o)}n.trigger=null}function f(n,t){var o,i,r,e,u,l;if(n.trigger=t,n.payload&&(u=n.payload,b=n,h(u),n.payload&&(u.gen++,l=u.fn,u.value=l(),u.listening&&n.inbound)))for(o=-1,i=n.inbound.length;++o<i;)r=n.inbound[o],r.active&&r.gen<u.gen&&y(r);for(n.cur=-1,i=n.outbound?n.outbound.length:0;++n.cur<i;)r=n.outbound[n.cur],r&&r.marked&&(e=r.to,r.marked=!1,e.marks--,0===e.marks&&f(e,n));n.trigger=null}function d(n,t){for(var o,i,r=-1,e=n.inbound.length;++r<e;)o=n.inbound[r],o&&o.marked&&(o.from.marked?d(o.from,t):(i=b,f(o.from,t),b=i))}function c(n){n.marks=0,n.trigger=null,n.cur=0;for(var t,o=-1,i=n.outbound.length;++o<i;)t=n.outbound[o],t&&t.marked&&(t.marked=!1,c(t.to))}function p(n){for(var t,o,i;n!==n.trigger&&(n=n.trigger);)for(t=n.outbound.length;++n.cur<t;)o=n.outbound[n.cur],o&&o.marked&&(i=o.to,o.marked=!1,i.marks--,0===i.marks&&f(i,n))}function h(n){var t=-1,o=n.cleanups,i=o.length;for(n.cleanups=[];++t<i;)o[t]()}function g(n,t){n.active||(n.active=!0,t.outbound[n.outboundOffset]=n,n.from=t),n.gen=n.to.payload.gen}function y(n){n.active=!1,n.from.outbound&&(n.from.outbound[n.outboundOffset]=null),n.from=null}"object"==typeof module&&"object"==typeof module.exports?module.exports=n:"function"==typeof define?define([],function(){return n}):(eval||!1)("this").S=n;var m=0,b=null,v=null;n.data=function w(n){function w(i){return arguments.length>0?(b&&p(b),n=i,t(o)):a(o),n}var o=new e(++m,null,b?b.region:null);return w.toJSON=r,w},i.prototype={on:function(){return this.options.sources=Array.prototype.slice.apply(arguments),this},once:function(){return this.options.sources=[],this},pin:function(){return this.options.pin=!0,this},defer:function(){return this},throttle:function(t){var o=n.region(),i=0;return this.options.region=function(n){var r=Date.now();o(n),r-i>t?(i=r,o.go()):setTimeout(function(){i=Date.now(),o.go()},t-(r-i))},this},debounce:function(t){var o=n.region(),i=0,r=0;return this.options.region=function(n){var e=Date.now();o(n),e>i&&(i=e,r&&clearTimeout(r),r=setTimeout(o.go,t))},this},pause:function(n){return this.options.region=n,this},when:function(){var n=Array.prototype.slice.apply(arguments),t=n.length;return this.options.sources=n,this.options.region=this.options.init=function(){for(var o=-1;++o<t;)if(void 0===n[o]())return!1;return!0},this}},"on once defer throttle debounce pause when".split(" ").map(function(t){n[t]=function(){var n=new i;return n[t].apply(n,arguments)}}),i.prototype.S=n,n.region=function k(){function k(n){o[n.id]||(t.push(n),o[n.id]=n)}function n(){var n,i;for(n=-1;++n<t.length;)s(t[n]);i=b,b=null,n=-1;try{for(;++n<t.length;)f(t[n],t[n])}catch(r){for(n--;++n<t.length;)c(t[n]);throw r}finally{b=i}t=[],o={}}var t=[],o={};return k.go=n,k},n.peek=function(n){if(!(b&&b.payload&&b.payload.listening))return n();b.payload.listening=!1;try{return n()}finally{b.payload&&(b.payload.listening=!0)}},n.pin=function(n){if(0===arguments.length)return(new i).pin();if(!b||!b.payload||b.payload.pinning)return n();b.payload.pinning=!0;try{return n()}finally{b.payload&&(b.payload.pinning=!1)}},n.cleanup=function(n){if(!b||!b.payload)throw new Error("S.cleanup() must be called from within an S.formula.  Cannot call it at toplevel.");b.payload.cleanups.push(n)},n.finalize=function(n){if(!b||!b.payload)throw new Error("S.finalize() must be called from within an S.formula.  Cannot call it at toplevel.");b.payload.finalizers.push(n)},n.freeze=function z(t){if(v)t();else{var z=v=n.region();try{t()}finally{v=null}z.go()}}}();