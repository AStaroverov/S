!function(e){var t={};e(function(e,n,i){if(t.hasOwnProperty(e))throw new Error("define: cannot redefine module "+e);t[e]=i.apply(null,n.map(function(n){if(!t.hasOwnProperty(n))throw new Error("define: module "+n+" required by "+e+" has not been defined.");return t[n]}))}),"object"==typeof module&&"object"==typeof module.exports?module.exports=t.S:"function"==typeof define?define([],function(){return t.S}):this.S=t.S}(function(e){"use strict";e("graph",[],function(){function e(){this.count=1,this.target=null,this.deferred=[]}function t(e){this.id=e.count++,this.lineage=e.target?e.target.lineage:[],this.updates=[]}function n(e,t,n){var i,r,s;for(this.lineage=n.target?n.target.lineage.slice(0):[],this.lineage.push(this),this.scheduler=t.update,this.listening=!0,this.pinning=!1,this.locked=!0,this.gen=1,this.dependencies=[],this.dependenciesIndex={},this.cleanups=[],this.finalizers=[],this.updaters=new Array(this.lineage.length+1),this.updaters[this.lineage.length]=e,i=this.lineage.length-1;i>=0;i--)r=this.lineage[i],r.scheduler&&(e=r.scheduler(e)),this.updaters[i]=e;if(t.sources){s=n.target,n.target=this,this.locked=!1;try{for(i=0;i<t.sources.length;i++)t.sources[i]()}finally{this.locked=!0,n.target=s}this.listening=!1}}function i(e,t){this.active=!0,this.gen=e.gen,this.updates=t.updates,this.offset=t.updates.length;for(var n=0,i=Math.min(e.lineage.length,t.lineage.length);i>n&&e.lineage[n]===t.lineage[n];n++);this.update=e.updaters[n],this.updates.push(this.update),e.dependencies.push(this),e.dependenciesIndex[t.id]=this}return e.prototype={reportReference:function(e){this.target&&this.target.addSource(e)},reportFormula:function(e){this.target&&this.target.addSubformula(e)},runDeferred:function(){if(!this.target)for(;0!==this.deferred.length;)this.deferred.shift()()}},t.prototype={propagate:function(){var e,t,n=this.updates;for(e=0;e<n.length;e++)t=n[e],t&&t()},dispose:function(){this.lineage=null,this.updates.length=0}},n.prototype={beginUpdate:function(){this.cleanup(),this.gen++},endUpdate:function(){if(this.listening){var e,t;for(e=0;e<this.dependencies.length;e++)t=this.dependencies[e],t.active&&t.gen<this.gen&&t.deactivate()}},addSubformula:function(e){if(this.locked)throw new Error("Cannot create a new subformula except while updating the parent");(this.pinning?this.finalizers:this.cleanups).push(e)},addSource:function(e){if(this.listening&&!this.locked){var t=this.dependenciesIndex[e.id];t?t.activate(this.gen,e):new i(this,e)}},cleanup:function(){for(var e=0;e<this.cleanups.length;e++)this.cleanups[e]();this.cleanups=[]},dispose:function(){var e;for(this.cleanup(),e=0;e<this.finalizers.length;e++)this.finalizers[e]();for(e=this.dependencies.length-1;e>=0;e--)this.dependencies[e].deactivate();this.lineage=null,this.scheduler=null,this.updaters=null,this.cleanups=null,this.finalizers=null,this.dependencies=null,this.dependenciesIndex=null}},i.prototype={activate:function(e,t){this.active||(this.active=!0,this.updates=t.updates,this.updates[this.offset]=this.update),this.gen=e},deactivate:function(){this.active&&(this.updates[this.offset]=null,this.updates=null),this.active=!1}},{Overseer:e,Source:t,Target:n,Dependency:i}}),e("core",["graph"],function(e){function t(t){function n(e){if(arguments.length>0){if(void 0===e)throw new Error("S.data can't be set to undefined.  In S, undefined is reserved for namespace lookup failures.");t=e,i.propagate(),w.runDeferred()}else w.reportReference(i);return t}if(void 0===t)throw new Error("S.data can't be initialized with undefined.  In S, undefined is reserved for namespace lookup failures.");var i=new e.Source(w);return n.toJSON=s,Array.isArray(t)&&h(n),n}function n(){function t(e){if(arguments.length>0){if(void 0===e)throw new Error("S.promise can't be resolved with undefined.  In S, undefined is reserved for namespace lookup failures.");n=e,i.propagate(),w.runDeferred()}else w.reportReference(i);return n}var n=void 0,i=new e.Source(w);return t.toJSON=s,t}function i(){this.sources=null,this.update=null,this.init=null}function r(t,n){function i(){return c&&w.reportReference(c),u}function r(){if(!a&&f){a=!0;var e,n;e=w.target,w.target=f,f.beginUpdate(),f.locked=!1;try{n=t(),f&&(f.locked=!0),void 0!==n&&(u=n,c&&c.propagate())}finally{a=!1,f&&(f.locked=!0),w.target=e}f&&f.endUpdate()}}function o(){c&&(c.dispose(),f.dispose()),c=f=t=u=void 0}var u,a,c=new e.Source(w),f=new e.Target(r,n,w);return w.reportFormula(o),i.dispose=o,i.toJSON=s,(n.init?n.init(r):r)(),w.runDeferred(),i}function s(){return this()}function o(e){if(!w.target||!w.target.listening)return e();w.target.listening=!1;try{return e()}finally{w.target.listening=!0}}function u(e){if(!w.target||w.target.pinning)return e();w.target.pinning=!0;try{return e()}finally{w.target.pinning=!1}}function a(e){w.target?w.deferred.push(e):e()}function c(e){if(!w.target)throw new Error("S.cleanup() must be called from within an S.formula.  Cannot call it at toplevel.");w.target.cleanups.push(e)}function f(e){if(!w.target)throw new Error("S.finalize() must be called from within an S.formula.  Cannot call it at toplevel.");w.target.finalizers.push(e)}function h(e){e.push=l,e.pop=p,e.shift=d,e.unshift=g,e.splice=v,e.remove=m}function l(e){var t=o(this);return t.push(e),this(t),e}function p(){var e=o(this),t=e.pop();return this(e),t}function d(){var e=o(this),t=e.shift();return this(e),t}function g(e){var t=o(this);return t.unshift(e),this(t),e}function v(){var e=o(this),t=e.splice.apply(e,arguments);return this(e),t}function m(e){var t=o(this),n=t.indexOf(e);return-1!==n?(t.splice(n,1),this(t),e):void 0}var w=new e.Overseer;return{data:t,promise:n,FormulaOptions:i,formula:r,defer:a,peek:o,cleanup:c,finalize:f,pin:u}}),e("schedulers",["core"],function(e){function t(){return function(){}}function n(e){return function(t){var n=!1;return function(){n||(n=!0,e(function(){n=!1,t()}))}}}function i(){return n(e.defer)}function r(e){return function(t){var n=0,i=!1;return function(){if(!i){var r=Date.now();r-n>e?(n=r,t()):(i=!0,setTimeout(function(){n=Date.now(),i=!1,t()},e-(r-n)))}}}}function s(e){return function(t){var n=0,i=0;return function(){var r=Date.now();r>n&&(n=r,i&&clearTimeout(i),i=setTimeout(function(){t()},e))}}}function o(){function e(e){n.push(e)}function t(){for(var e=0;e<n.length;e++)n[e]();n=[]}var n=[];return e.go=t,e}function u(e){return function(t){for(var n=0;n<e.length;n++)if(void 0===e[n]())return;t()}}return{stop:t,pause:n,defer:i,throttle:r,debounce:s,stopsign:o,when:u}}),e("options",["core","schedulers"],function(e,t){function n(){this.options=new e.FormulaOptions}function i(e,t){return t?function(){return e(t())}:e}function r(e,t){return e?e.concat(t):t}function s(e,t){e.options.update=i(t,e.options.update)}function o(e,t){e.options.init=i(t,e.options.init)}return n.prototype={on:function(e){return e=e?Array.isArray(e)?e:[e]:[],this.options.sources=r(this.options.sources,e),this},once:function(){return this.options.sources=[],this},skipFirst:function(){if(null===this.options.sources||0===this.options.sources.length)throw new Error("to use skipFirst, you must first have specified at least one dependency with .on(...)");return o(this,t.stop),this},when:function(e){e=e?Array.isArray(e)?e:[e]:[],this.options.sources=r(this.options.sources,e);var n=t.pause(t.when(e));return o(this,n),s(this,n),this}},"defer throttle debounce pause".split(" ").map(function(e){n.prototype[e]=function(n){return s(this,t[e](n)),this}}),{FormulaOptionsBuilder:n}}),e("misc",[],function(){function e(e,t){return function(n){return 0!==arguments.length&&t(n),e()}}return{proxy:e}}),e("S",["core","options","schedulers","misc"],function(e,t,n,i){function r(t){if(arguments.length>1){var n=t,i=Array.prototype.slice.call(arguments,1);t=function(){return n.apply(null,i)}}return e.formula(t,new e.FormulaOptions)}return r.data=e.data,r.promise=e.promise,r.peek=e.peek,r.cleanup=e.cleanup,r.finalize=e.finalize,r.pin=e.pin,"on once when defer throttle debounce pause".split(" ").map(function(e){r[e]=function(n){return(new t.FormulaOptionsBuilder)[e](n)}}),t.FormulaOptionsBuilder.prototype.S=function(t){if(arguments.length>1){var n=t,i=Array.prototype.slice.call(arguments,1);t=function(){return n.apply(null,i)}}return e.formula(t,this.options)},r.stopsign=n.stopsign,r.proxy=i.proxy,r})});