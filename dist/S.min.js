!function(){"use strict";function n(){for(var n,t,o,u,i=0;0!==(n=m.nodes,o=m.len);){for(t=-1;++t<o;)u=n[t],u.value=m.values[t],m.values[t]=null,e(u);m.nodes=m.nodes2,m.nodes2=n,m.len=0,v=!0,t=-1;try{for(;++t<o;)u=n[t],r(u),n[t]=null}finally{for(t--;++t<o;)l(n[t]),n[t]=null;v=!1,b=null}if(++i>1e5){for(t=-1;++t<m.len;)m.nodes[t]=null;throw m.len=0,new Error("Runaway frames detected")}}}function t(t,o){var u=!1;t.value=o,e(t),v=!0;try{r(t),u=!0}finally{u||l(t),v=!1,b=null}0!==m.len&&n()}function o(){this._sources=null,this._pin=!1,this._init=null,this._gate=null}function u(){return this()}function i(n){var t=b,o=null;t&&t.payload&&t.payload.listening&&(o=t.inboundIndex[n.id],o?s(o,n):new _(n,t,t.gate&&n.gate!==t.gate))}function e(n){n.updating=!0;for(var t,o,u=-1,i=n.outbound.length;++u<i;)if(t=n.outbound[u],t&&(!t.boundary||t.to.gate(t.to))){if(o=t.to,o.updating)throw new Error("circular dependency");t.marked=!0,o.marks++,1===o.marks&&e(o)}n.updating=!1}function r(n){var t,o,u,i,e;if(n.updating=!0,n.payload&&(e=n.payload,b=n,d(e),n.payload&&(e.gen++,n.value=e.fn(),e.listening&&n.inbound))){for(t=-1,o=n.inbound.length;++t<o;)u=n.inbound[t],u.active&&u.gen<e.gen&&f(u);o>10&&o/n.inboundActive>4&&c(n)}for(n.cur=-1,o=n.outbound?n.outbound.length:0;++n.cur<o;)u=n.outbound[n.cur],u&&u.marked&&(i=u.to,u.marked=!1,i.marks--,0===i.marks&&r(i));o>10&&o/n.outboundActive>4&&h(n),n.updating=!1}function a(n){for(var t,o,u=-1,i=n.inbound.length;++u<i;)t=n.inbound[u],t&&t.marked&&(t.from.marks?a(t.from):(o=b,r(t.from),b=o))}function l(n){n.marks=0,n.updating=!1,n.cur=0;for(var t,o=-1,u=n.outbound?n.outbound.length:0;++o<u;)t=n.outbound[o],t&&(t.marked||t.to.updating)&&(t.marked=!1,l(t.to))}function d(n){var t=-1,o=n.cleanups,u=o.length;for(n.cleanups=[];++t<u;)o[t]()}function s(n,t){n.active||(n.active=!0,n.outboundCompaction===t.outboundCompaction?t.outbound[n.outboundOffset]=n:(n.outboundCompaction=t.outboundCompaction,n.outboundOffset=t.outbound.length,t.outbound.push(n)),n.to.inboundActive++,t.outboundActive++,n.from=t),n.gen=n.to.payload.gen}function f(n){if(n.active){var t=n.from,o=n.to;n.active=!1,t.outbound&&(t.outbound[n.outboundOffset]=null),t.outboundActive--,o.inboundActive--,n.from=null}}function c(n){for(var t,o=-1,u=n.inbound.length,i=[],e=[];++o<u;)t=n.inbound[o],t.active&&(i.push(t),e[t.from.id]=t);n.inbound=i,n.inboundIndex=e}function h(n){for(var t,o=-1,u=n.outbound.length,i=[],e=++n.outboundCompaction;++o<u;)t=n.outbound[o],t&&(t.outboundOffset=i.length,t.outboundCompaction=e,i.push(t));n.outbound=i}var p=function(){function n(){this.len=0,this.values=[],this.nodes=[],this.nodes2=[]}return n.prototype.add=function(n,t){this.values[this.len]=t,this.nodes[this.len]=n,this.len++},n}(),g=0,b=null,v=!1,m=new p,y=function(t){function e(){if(!C){C=!0;var n,t;for(n=-1,t=A.inbound.length;++n<t;)f(A.inbound[n]);for(d(_),n=-1,t=_.finalizers.length;++n<t;)_.finalizers[n]();_.fn=null,_.finalizers=null,_=null,A.value=null,A.payload=null,A.inbound=null,A.inboundIndex=null,A.outbound=null,A=null}}var r,l,s,c=this instanceof o?this:new o,h=b,p=v,y=c._gate||h&&h.gate||null,_=new k(t),A=new w(++g,_,y),C=!1;if(b=A,c._sources){for(r=-1,l=c._sources.length;++r<l;)try{c._sources[r]()}catch(x){throw b=h,x}_.listening=!1}h&&(h.payload.pinning||c._pin?h.payload.finalizers.push(e):h.payload.cleanups.push(e)),p||(v=!0);try{(!c._init||c._init(A))&&(A.value=t())}finally{b=h,p||(v=!1)}return p||0===m.len||n(),s=function(){return C||(i(A),0!==A.marks&&a(A),C)?void 0:A.value},s.dispose=e,s.toJSON=u,s};y.data=function A(n){var A,o=new w(++g,null,b?b.gate:null);return o.value=n,A=function(n){return arguments.length>0?v?m.add(o,n):t(o,n):i(o),o.value},A.toJSON=u,A},o.prototype={pin:function(){return this._pin=!0,this},gate:function(n){return this._gate=n,this},S:y},y.on=function(){for(var n=[],t=0;t<arguments.length;t++)n[t-0]=arguments[t];var u=new o;return u._sources=n,u},y.when=function(){for(var n=[],t=0;t<arguments.length;t++)n[t-0]=arguments[t];var u=new o,i=n.length;return u._sources=n,u._gate=u._init=function(){for(var t=-1;++t<i;)if(void 0===n[t]())return!1;return!0},u},y.gate=function(n){return(new o).gate(n)},y.collector=function C(){function n(){var n,i;for(t=!0,n=-1;++n<o.length;)e(o[n]);i=b,b=null,n=-1;try{for(;++n<o.length;)r(o[n])}catch(a){for(n--;++n<o.length;)l(o[n]);throw a}finally{b=i,t=!1}o=[],u={}}var C,t=!1,o=[],u={};return C=function(n){var i=n;return t||u[i.id]||(o.push(i),u[i.id]=i),t},C.go=n,C},y.throttle=function(n){var t=y.collector(),o=0;return function(u){var i=Date.now();return t(u),i-o>n?(o=i,t.go()):setTimeout(function(){o=Date.now(),t.go()},n-(i-o)),!1}},y.debounce=function(n){var t=y.collector(),o=0,u=0;return function(i){var e=Date.now();return t(i),e>o&&(o=e,u&&clearTimeout(u),u=setTimeout(t.go,n)),!1}},y.peek=function(n){if(!(b&&b.payload&&b.payload.listening))return n();b.payload.listening=!1;try{return n()}finally{b.payload&&(b.payload.listening=!0)}},y.cleanup=function(n){if(!b||!b.payload)throw new Error("S.cleanup() must be called from within an S.computation.  Cannot call it at toplevel.");b.payload.cleanups.push(n)},y.freeze=function(t){var o;if(!v){v=!0;try{o=t()}finally{v=!1}return n(),o}t()},y.pin=function(n){if(0===arguments.length)return(new o).pin();if(!b||!b.payload||b.payload.pinning)return n();b.payload.pinning=!0;try{return n()}finally{b.payload.pinning=!1}};var w=function(){function n(n,t,o){this.value=void 0,this.marks=0,this.updating=!1,this.cur=0,this.inbound=[],this.inboundIndex=[],this.inboundActive=0,this.outbound=[],this.outboundIndex=[],this.outboundActive=0,this.outboundCompaction=0,this.id=n,this.payload=t,this.gate=o}return n}(),_=function(){function n(n,t,o){this.active=!0,this.marked=!1,this.from=n,this.to=t,this.boundary=o,this.gen=t.payload.gen,this.outboundOffset=n.outbound.length,this.outboundCompaction=n.outboundCompaction,n.outbound.push(this),t.inbound.push(this),t.inboundIndex[n.id]=this,n.outboundActive++,t.inboundActive++}return n}(),k=function(){function n(n){this.gen=1,this.listening=!0,this.pinning=!1,this.cleanups=[],this.finalizers=[],this.fn=n}return n}();"object"==typeof module&&"object"==typeof module.exports?module.exports=y:"function"==typeof define?define([],function(){return y}):(eval||function(){})("this").S=y}();