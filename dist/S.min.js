!function(){"use strict";function n(){this.len=0,this.values=[],this.nodes=[],this.nodes2=[]}function t(){for(var n,t,o,u,i=0;0!==(n=k.nodes,o=k.len);){for(t=-1;++t<o;)u=n[t],u.value=k.values[t],k.values[t]=null,s(u);k.nodes=k.nodes2,k.nodes2=n,k.len=0,_=!0,t=-1;try{for(;++t<o;)u=n[t],f(u),n[t]=null}finally{for(t--;++t<o;)h(n[t]),n[t]=null;_=!1,w=null}if(++i>1e5){for(t=-1;++t<k.len;)k.nodes[t]=null;throw k.len=0,new Error("Runaway frames detected")}}}function o(n,o){var u=!1;n.value=o,s(n),_=!0;try{f(n),u=!0}finally{u||h(n),_=!1,w=null}0!==k.len&&t()}function u(n){function o(){return C||(d(A),0!==A.marks&&c(A,w),C)?void 0:A.value}function u(){if(!C){C=!0;var n,t;for(n=-1,t=A.inbound.length;++n<t;)b(A.inbound[n]);for(p(y),n=-1,t=y.finalizers.length;++n<t;)y.finalizers[n]();y.fn=null,y.finalizers=null,y=null,A.value=null,A.payload=null,A.inbound=null,A.inboundIndex=null,A.outbound=null,A=null}}var r,s,f=this instanceof i?this:new i,h=w,g=_,v=f._gate||h&&h.gate||null,y=new l(n),A=new a(++m,y,v),C=!1;if(w=A,f._sources){for(r=-1,s=f._sources.length;++r<s;)try{f._sources[r]()}catch(x){throw w=h,x}y.listening=!1}h&&(h.payload.pinning||f._pin?h.payload.finalizers.push(u):h.payload.cleanups.push(u)),g||(_=!0);try{(!f._init||f._init(A))&&(A.value=n())}finally{w=h,g||(_=!1)}return g||0===k.len||t(),o.dispose=u,o.toJSON=e,o}function i(){this._sources=null,this._pin=!1,this._init=null,this._gate=null}function e(){return this()}function a(n,t,o){this.id=n,this.value=void 0,this.payload=t,this.gate=o,this.marks=0,this.updating=!1,this.cur=0,this.inbound=[],this.inboundIndex=[],this.inboundActive=0,this.outbound=[],this.outboundActive=0,this.outboundCompaction=0}function r(n,t,o){this.from=n,this.to=t,this.boundary=o,this.active=!0,this.marked=!1,this.gen=t.payload.gen,this.outboundOffset=n.outbound.length,this.outboundCompaction=n.outboundCompaction,n.outbound.push(this),t.inbound.push(this),t.inboundIndex[n.id]=this,n.outboundActive++,t.inboundActive++}function l(n){this.fn=n,this.gen=1,this.listening=!0,this.pinning=!1,this.cleanups=[],this.finalizers=[]}function d(n){var t=w,o=null;t&&t.payload&&t.payload.listening&&(o=t.inboundIndex[n.id],o?g(o,n):new r(n,t,t.gate&&n.gate!==t.gate))}function s(n){n.updating=!0;for(var t,o,u=-1,i=n.outbound.length;++u<i;)if(t=n.outbound[u],t&&(!t.boundary||t.to.gate(t.to))){if(o=t.to,o.updating)throw new Error("circular dependency");t.marked=!0,o.marks++,1===o.marks&&s(o)}n.updating=!1}function f(n){var t,o,u,i,e;if(n.updating=!0,n.payload&&(e=n.payload,w=n,p(e),n.payload&&(e.gen++,n.value=e.fn(),e.listening&&n.inbound))){for(t=-1,o=n.inbound.length;++t<o;)u=n.inbound[t],u.active&&u.gen<e.gen&&b(u);o>10&&o/n.inboundActive>4&&v(n)}for(n.cur=-1,o=n.outbound?n.outbound.length:0;++n.cur<o;)u=n.outbound[n.cur],u&&u.marked&&(i=u.to,u.marked=!1,i.marks--,0===i.marks&&f(i));o>10&&o/n.outboundActive>4&&y(n),n.updating=!1}function c(n){for(var t,o,u=-1,i=n.inbound.length;++u<i;)t=n.inbound[u],t&&t.marked&&(t.from.marks?c(t.from):(o=w,f(t.from),w=o))}function h(n){n.marks=0,n.updating=!1,n.cur=0;for(var t,o=-1,u=n.outbound?n.outbound.length:0;++o<u;)t=n.outbound[o],t&&(t.marked||t.to.updating)&&(t.marked=!1,h(t.to))}function p(n){var t=-1,o=n.cleanups,u=o.length;for(n.cleanups=[];++t<u;)o[t]()}function g(n,t){n.active||(n.active=!0,n.outboundCompaction===t.outboundCompaction?t.outbound[n.outboundOffset]=n:(n.outboundCompaction=t.outboundCompaction,n.outboundOffset=t.outbound.length,t.outbound.push(n)),n.to.inboundActive++,t.outboundActive++,n.from=t),n.gen=n.to.payload.gen}function b(n){if(n.active){var t=n.from,o=n.to;n.active=!1,t.outbound&&(t.outbound[n.outboundOffset]=null),t.outboundActive--,o.inboundActive--,n.from=null}}function v(n){for(var t,o=-1,u=n.inbound.length,i=[],e=[];++o<u;)t=n.inbound[o],t.active&&(i.push(t),e[t.from.id]=t);n.inbound=i,n.inboundIndex=e}function y(n){for(var t,o=-1,u=n.outbound.length,i=[],e=++n.outboundCompaction;++o<u;)t=n.outbound[o],t&&(t.outboundOffset=i.length,t.outboundCompaction=e,i.push(t));n.outbound=i}"object"==typeof module&&"object"==typeof module.exports?module.exports=u:"function"==typeof define?define([],function(){return u}):(eval||function(){})("this").S=u,n.prototype={add:function(n,t){this.values[this.len]=t,this.nodes[this.len]=n,this.len++}};var m=0,w=null,_=!1,k=new n;u.data=function A(n){function A(n){return arguments.length>0?_?k.add(t,n):o(t,n):d(t),t.value}var t=new a(++m,null,w?w.gate:null);return t.value=n,A.toJSON=e,A},i.prototype={pin:function(){return this._pin=!0,this},gate:function(n){return this._gate=n,this},S:u},u.on=function(){var n=new i;return n._sources=Array.prototype.slice.apply(arguments),n},u.when=function(){var n=new i,t=Array.prototype.slice.apply(arguments),o=t.length;return n._sources=t,n._gate=n._init=function(){for(var n=-1;++n<o;)if(void 0===t[n]())return!1;return!0},n},u.gate=function(n){return(new i).gate(n)},u.collector=function C(){function C(n){return t||u[n.id]||(o.push(n),u[n.id]=n),t}function n(){var n,i;for(t=!0,n=-1;++n<o.length;)s(o[n]);i=w,w=null,n=-1;try{for(;++n<o.length;)f(o[n])}catch(e){for(n--;++n<o.length;)h(o[n]);throw e}finally{w=i,t=!1}o=[],u={}}var t=!1,o=[],u={};return C.go=n,C},u.throttle=function(n){var t=u.collector(),o=0;return function(u){var i=Date.now();t(u),i-o>n?(o=i,t.go()):setTimeout(function(){o=Date.now(),t.go()},n-(i-o))}},u.debounce=function(n){var t=u.collector(),o=0,i=0;return function(u){var e=Date.now();t(u),e>o&&(o=e,i&&clearTimeout(i),i=setTimeout(t.go,n))}},u.peek=function(n){if(!(w&&w.payload&&w.payload.listening))return n();w.payload.listening=!1;try{return n()}finally{w.payload&&(w.payload.listening=!0)}},u.cleanup=function(n){if(!w||!w.payload)throw new Error("S.cleanup() must be called from within an S.computation.  Cannot call it at toplevel.");w.payload.cleanups.push(n)},u.freeze=function(n){if(_)n();else{_=!0;try{n()}finally{_=!1}t()}},u.pin=function(n){if(0===arguments.length)return(new i).pin();if(!w||!w.payload||w.payload.pinning)return n();w.payload.pinning=!0;try{return n()}finally{w.payload.pinning=!1}}}();