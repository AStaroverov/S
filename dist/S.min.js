!function(){"use strict";function n(n){function t(){return k||(a(v),0!==v.marks&&c(v,y),k)?void 0:v.payload.value}function e(){if(!k){k=!0;var n,t;for(n=-1,t=v.inbound.length;++n<t;)p(v.inbound[n]);for(g(b),n=-1,t=b.finalizers.length;++n<t;)b.finalizers[n]();b.fn=null,b.value=null,b.finalizers=null,b=null,v.payload=null,v.inbound=null,v.inboundIndex=null,v.outbound=null,v=null}}var l,d,s=this instanceof o?this:new o,f=y,h=s._gate||f&&f.gate||null,b=new r(n),v=new i(++m,b,h),k=!1;if(y=v,s._sources){for(l=-1,d=s._sources.length;++l<d;)try{s._sources[l]()}catch(w){throw y=f,w}b.listening=!1}f&&(f.payload.pinning||s._pin?f.payload.finalizers.push(e):f.payload.cleanups.push(e)),v.trigger=f||v;try{(!s._init||s._init(v))&&(v.payload.value=n())}finally{k||(v.trigger=null),y=f}return t.dispose=e,t.toJSON=u,t}function t(n){var t;if(k)k(n);else{l(n),t=y,y=null;try{d(n,t||n)}catch(o){throw s(n),o}finally{y=t}}}function o(){this._sources=null,this._pin=!1,this._init=null,this._gate=null}function u(){return this()}function i(n,t,o){this.id=n,this.payload=t,this.gate=o,this.marks=0,this.trigger=null,this.cur=0,this.inbound=[],this.inboundIndex=[],this.inboundActive=0,this.outbound=[],this.outboundActive=0,this.outboundCompaction=0}function e(n,t,o){this.from=n,this.to=t,this.boundary=o,this.active=!0,this.marked=!1,this.gen=t.payload.gen,this.outboundOffset=n.outbound.length,this.outboundCompaction=n.outboundCompaction,n.outbound.push(this),t.inbound.push(this),t.inboundIndex[n.id]=this,n.outboundActive++,t.inboundActive++}function r(n){this.fn=n,this.gen=1,this.value=void 0,this.listening=!0,this.pinning=!1,this.cleanups=[],this.finalizers=[]}function a(n){var t=y,o=null;t&&t.payload&&t.payload.listening&&(o=t.inboundIndex[n.id],o?h(o,n):new e(n,t,t.gate&&n.gate!==t.gate))}function l(n){n.trigger=n;for(var t,o,u=-1,i=n.outbound.length;++u<i;)if(t=n.outbound[u],t&&!t.marked&&(!t.boundary||t.to.gate(t.to))){if(o=t.to,o.trigger)throw new Error("circular dependency");t.marked=!0,o.marks++,1===o.marks&&l(o)}n.trigger=null}function d(n,t){var o,u,i,e,r;if(n.trigger=t,n.payload&&(r=n.payload,y=n,g(r),n.payload&&(r.gen++,r.value=r.fn(),r.listening&&n.inbound))){for(o=-1,u=n.inbound.length;++o<u;)i=n.inbound[o],i.active&&i.gen<r.gen&&p(i);u>10&&u/n.inboundActive>4&&b(n)}for(n.cur=-1,u=n.outbound?n.outbound.length:0;++n.cur<u;)i=n.outbound[n.cur],i&&i.marked&&(e=i.to,i.marked=!1,e.marks--,0===e.marks&&d(e,n));u>10&&u/n.outboundActive>4&&v(n),n.trigger=null}function c(n,t){for(var o,u,i=-1,e=n.inbound.length;++i<e;)o=n.inbound[i],o&&o.marked&&(o.from.marked?c(o.from,t):(u=y,d(o.from,t),y=u))}function s(n){n.marks=0,n.trigger=null,n.cur=0;for(var t,o=-1,u=n.outbound.length;++o<u;)t=n.outbound[o],t&&(t.marked||t.to.trigger)&&(t.marked=!1,s(t.to))}function f(n){for(var t,o,u;n!==n.trigger&&(n=n.trigger);)for(t=n.outbound.length;++n.cur<t;)o=n.outbound[n.cur],o&&o.marked&&(u=o.to,o.marked=!1,u.marks--,0===u.marks&&d(u,n))}function g(n){var t=-1,o=n.cleanups,u=o.length;for(n.cleanups=[];++t<u;)o[t]()}function h(n,t){n.active||(n.active=!0,n.outboundCompaction===t.outboundCompaction?t.outbound[n.outboundOffset]=n:(n.outboundCompaction=t.outboundCompaction,n.outboundOffset=t.outbound.length,t.outbound.push(n)),n.to.inboundActive++,t.outboundActive++,n.from=t),n.gen=n.to.payload.gen}function p(n){if(n.active){var t=n.from,o=n.to;n.active=!1,t.outbound&&(t.outbound[n.outboundOffset]=null),t.outboundActive--,o.inboundActive--,n.from=null}}function b(n){for(var t,o=-1,u=n.inbound.length,i=[],e=[];++o<u;)t=n.inbound[o],t.active&&(i.push(t),e[t.from.id]=t);n.inbound=i,n.inboundIndex=e}function v(n){for(var t,o=-1,u=n.outbound.length,i=[],e=++n.outboundCompaction;++o<u;)t=n.outbound[o],t&&(t.outboundOffset=i.length,t.outboundCompaction=e,i.push(t));n.outbound=i}"object"==typeof module&&"object"==typeof module.exports?module.exports=n:"function"==typeof define?define([],function(){return n}):(eval||!1)("this").S=n;var m=0,y=null,k=null;n.data=function w(n){function w(u){return arguments.length>0?(y&&f(y),n=u,t(o)):a(o),n}var o=new i(++m,null,y?y.gate:null);return w.toJSON=u,w},o.prototype={pin:function(){return this._pin=!0,this},gate:function(n){return this._gate=n,this},S:n},n.on=function(){var n=new o;return n._sources=Array.prototype.slice.apply(arguments),n},n.when=function(){var n=new o,t=Array.prototype.slice.apply(arguments),u=t.length;return n._sources=t,n._gate=n._init=function(){for(var n=-1;++n<u;)if(void 0===t[n]())return!1;return!0},n},n.gate=function(n){return(new o).gate(n)},n.pin=function(){return(new o).pin()},n.collector=function _(){function _(n){return t||u[n.id]||(o.push(n),u[n.id]=n),t}function n(){var n,i;for(t=!0,n=-1;++n<o.length;)l(o[n]);i=y,y=null,n=-1;try{for(;++n<o.length;)d(o[n],o[n])}catch(e){for(n--;++n<o.length;)s(o[n]);throw e}finally{y=i,t=!1}o=[],u={}}var t=!1,o=[],u={};return _.go=n,_},n.throttle=function(t){var o=n.collector(),u=0;return function(n){var i=Date.now();o(n),i-u>t?(u=i,o.go()):setTimeout(function(){u=Date.now(),o.go()},t-(i-u))}},n.debounce=function(t){var o=n.collector(),u=0,i=0;return function(n){var e=Date.now();o(n),e>u&&(u=e,i&&clearTimeout(i),i=setTimeout(o.go,t))}},n.peek=function(n){if(!(y&&y.payload&&y.payload.listening))return n();y.payload.listening=!1;try{return n()}finally{y.payload&&(y.payload.listening=!0)}},n.cleanup=function(n){if(!y||!y.payload)throw new Error("S.cleanup() must be called from within an S.computation.  Cannot call it at toplevel.");y.payload.cleanups.push(n)},n.freeze=function A(t){if(k)t();else{var A=k=n.collector();try{t()}finally{k=null}A.go()}}}();