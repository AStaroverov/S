!function(t){var n={};t(function(t,e,i){if(n.hasOwnProperty(t))throw new Error("define: cannot redefine module "+t);n[t]=i.apply(null,e.map(function(e){if(!n.hasOwnProperty(e))throw new Error("define: module "+e+" required by "+t+" has not been defined.");return n[e]}))}),"object"==typeof module&&"object"==typeof module.exports?module.exports=n.S:"function"==typeof define?define([],function(){return n.S}):this.S=n.S}(function(t){"use strict";t("S",[],function(){function t(n,e){return t.lift(n,e)}function n(n,r){return"function"==typeof n?i(n,r):n instanceof Array?t.seq(n):e(n)}function e(t){function n(n){if(arguments.length>0){if(void 0===n)throw new Error("S.data can't be set to undefined.  In S, undefined is reserved for namespace lookup failures.");t=n,e.propagate(),g.runDeferred()}else g.ctx&&g.ctx.addSource(e);return t}if(void 0===t)throw new Error("S.data can't be initialized with undefined.  In S, undefined is reserved for namespace lookup failures.");var e=new o(g);return n.S=new a,n.toString=c,n}function i(t){function n(){return g.ctx&&g.ctx.addSource(c),a}function e(){g.runInContext(i,h)}function i(){var n=t();void 0!==n&&(a=n,c.propagate())}function r(){h.cleanup(),h.dispose()}function s(){return"[formula: "+t+"]"}var a,c=new o(g),h=new u(e,this||{},g);return g.ctx&&g.ctx.addChild(r),n.S=new f(r),n.dispose=r,n.toString=s,e(),g.runDeferred(),n}function r(){this.count=1,this.ctx=null,this.deferred=[]}function o(t){this.id=t.count++,this.lineage=t.ctx?t.ctx.lineage:[],this.updates=[]}function u(t,n,e){var i,r;for(this.lineage=e.ctx?e.ctx.lineage.slice(0):[],this.lineage.push(this),this.mod=n.mod,this.updaters=[],i=this.lineage.length-1;i>=0;i--)r=this.lineage[i],r.mod&&(t=r.mod(t)),this.updaters[i]=t;if(this.updating=!1,this.gen=1,this.registrations=[],this.registrationIndex={},this.cleanups=[],this.finalizers=[],this.listening=!n.sources,n.sources)for(var i=0;i<n.sources.length;i++)new s(this,n.sources[i])}function s(t,n){this.active=!0,this.gen=t.gen,this.updates=n.updates,this.offset=n.updates.length;for(var e=0,i=Math.min(t.lineage.length,n.lineage.length);i>e&&t.lineage[e]===n.lineage[e];e++);this.update=t.updaters[e],this.updates.push(this.update),t.registrations.push(this),t.registrationIndex[n.id]=this}function a(){}function f(t){this.detach=t}function c(){return"[data: "+t.peek(this)+"]"}function h(t){return g.runWithoutListening(t)}function p(t){g.ctx?g.deferred.push(t):t()}function d(t){if(!g.ctx)throw new Error("S.cleanup() must be called from within an S.formula.  Cannot call it at toplevel.");g.ctx.cleanups.push(t)}function l(t){if(!g.ctx)throw new Error("S.finalize() must be called from within an S.formula.  Cannot call it at toplevel.");g.ctx.finalizers.push(t)}var g=new r;return t.lift=n,t.data=e,t.formula=i,t.peek=h,t.defer=p,t.cleanup=d,t.finalize=l,t.data.S=a,t.formula.S=f,f.prototype=new a,r.prototype.runInContext=function(t,n){if(!n.updating){var e;e=this.ctx,this.ctx=n,n.beginUpdate();try{return t()}finally{n.endUpdate(),this.ctx=e}}},r.prototype.runWithoutListening=function(t){var n;this.ctx&&(n=this.ctx.listening,this.ctx.listening=!1);try{return t()}finally{this.ctx&&(this.ctx.listening=n)}},r.prototype.runDeferred=function(){if(!this.ctx)for(;0!==this.deferred.length;)this.deferred.shift()()},o.prototype.propagate=function(){var t,n,e=this.updates;for(t=0;t<e.length;t++)n=e[t],n&&n()},u.prototype.beginUpdate=function(){this.cleanup(),this.gen++,this.updating=!0},u.prototype.endUpdate=function(){if(this.updating=!1,this.listening){var t,n;for(t=0;t<this.registrations.length;t++)n=this.registrations[t],n.active&&n.gen<this.gen&&n.deactivate()}},u.prototype.addSource=function(t){if(this.listening){var n=this.registrationIndex[t.id];n?n.activate(this.gen):new s(this,t)}},u.prototype.addChild=function(t){this.cleanups.push(t)},u.prototype.cleanup=function(){for(var t=0;t<this.cleanups.length;t++)this.cleanups[t]();this.cleanups=[]},u.prototype.dispose=function(){var t;for(t=0;t<this.finalizers.length;t++)this.finalizers[t]();for(t=this.registrations.length-1;t>=0;t--)this.registrations[t].deactivate()},s.prototype.activate=function(t){this.active||(this.active=!0,this.updates[this.offset]=this.update),this.gen=t},s.prototype.deactivate=function(){this.active&&(this.updates[this.offset]=null),this.active=!1},t}),t("Chainable",[],function(){function t(t,n){return function(e){return t(n(e))}}return function(n,e,i,r){this.head=void 0!==r?r:i&&void 0!==i.head?i.head:null,this[e]=i&&void 0!==i[e]?t(n,i[e]):n}}),t("S.sub",["S"],function(t){t.sub=function n(){var e=Array.prototype.slice.call(arguments),i=function(){},r=e.pop(),o=e.length,u=new Array(o),n=this.S(function(){for(var n=0;o>n;n++)u[n]=e[n]();return t.peek(function(){return i.apply(void 0,u)})});return i=r,n}}),t("S.mods",["S","Chainable"],function(t,n){function e(t,e){n.call(this,t,"mod",e)}function i(){return new e(y(arguments.slice(0)),this)}function r(){return new e(y([]),this)}function o(){return new e(h(),this)}function u(t){return new e(p(t),this)}function s(t){return new e(l(t),this)}function a(t){return new e(d(t),this)}function f(t){return new e(g(t),this)}function c(t){return new e(v(t),this)}function h(t){return void 0!==t?w(t):function(t){var n=!1;return function(){n||(n=!0,w(function(){n=!1,t()}))}}}function p(t){return function(n){return function(){setTimeout(n,t)}}}function d(t){return function(n){var e=0,i=!1;return function(){if(!i){var r=Date.now();r-e>t?(e=r,n()):(i=!0,setTimeout(function(){e=Date.now(),i=!1,n()},t-(r-e)))}}}}function l(t){return function(n){var e=0,i=0;return function(){var r=Date.now();r>e&&(e=r,i&&clearTimeout(i),i=setTimeout(n,t))}}}function g(n){var e=[];return t.formula(function(){if(n()){for(var t=0;t<e.length;t++)e[t]();e=[]}}),function(t){return function(){e.push(t)}}}function v(n){var e=[];return t.formula(function(){if(n()){for(var t=0;t<e.length;t++)e[t]();e=[]}}),function(t){var n=!1;return function(){n||(n=!0,e.push(function(){n=!1,t()}))}}}function y(){return function(t){return t}}var w=t.defer;e.prototype=new n,e.prototype.S=t.formula,e.prototype.sub=t.sub,t.on=e.prototype.on=i,t.once=e.prototype.once=r,t.defer=e.prototype.defer=o,t.delay=e.prototype.delay=u,t.debounce=e.prototype.debounce=s,t.throttle=e.prototype.throttle=a,t.pause=e.prototype.pause=f,t.throttledPause=e.prototype.throttledPause=c}),t("S.toJSON",["S"],function(t){t.toJSON=function(t){return JSON.stringify(t,function(t,n){return"function"==typeof n&&n.S?n():n})}})});