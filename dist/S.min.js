!function(){"use strict";function n(n){return function(){for(var t=0;t<n.length;t++)n[t]()}}function t(n,t){var e=t.id,u=n.nodes[e];u!==t&&(u!==z&&(n.ids[n.count++]=e),n.nodes[e]=t,t.sources[t.count++]=n)}function e(n,e){n.log||(n.log=new p),t(n.log,e)}function u(n,e){n.log||(n.log=new p),t(n.log,e)}function o(n){try{i(n)}finally{m=!1,E=b=null}}function r(n){try{n.value=n.fn(n.value),S.count>0&&i(null)}finally{m=!1,E=b=null}}function i(n){var t,e=0;for(m=!0,x.reset(),A.reset(),n&&(S.reset(),y++,l(n),x.run(f),A.run(d));0!==S.count;)if(t=S,S=j,j=t,S.reset(),y++,t.run(l),x.run(f),A.run(d),e++>1e5)throw new Error("Runaway frames detected")}function l(n){n.value=n.pending,n.pending=R,n.log&&a(n.log)}function a(n){for(var t=n.nodes,e=n.ids,u=0,o=0;o<n.count;o++){var r=e[o],i=t[r];i===z?(t[r]=C,u++):(i.age<y&&(i.age=y,i.state=q,x.add(i),i.owned&&c(i.owned),i.log&&a(i.log)),u&&(e[o-u]=r))}u&&(n.count-=u)}function c(n){for(var t=0;t<n.length;t++){var e=n[t];e.age=y,e.state=k,e.owned&&c(e.owned)}}function f(n){if(n.state===q){var t=E,e=b;E=b=n,n.state=B,s(n,!1),n.value=n.fn(n.value),n.state=k,E=t,b=e}}function s(n,t){var e=n.sources,u=n.cleanups,o=n.owned;if(u){for(var r=0;r<u.length;r++)u[r](t);n.cleanups=null}if(o){for(var r=0;r<o.length;r++)d(o[r]);n.owned=null}for(var r=0;r<n.count;r++)e[r].nodes[n.id]=z,e[r]=null;n.count=0}function d(n){n.fn=null,n.log=null,s(n,!0)}var h=function(n,t){var e=E,o=b,i=new g(n,t);if(E=b=i,m?i.value=i.fn(i.value):(m=!0,S.reset(),r(i)),!e)throw new Error("all computations must be created under a parent computation or root");return(e.owned||(e.owned=[])).push(i),E=e,b=o,function(){if(E){if(i.age===y){if(i.state===B)throw new Error("circular dependency");f(i)}b&&u(i,b)}return i.value}};h.root=function D(n){function t(){m?A.add(D):d(D)}var e=E,D=new g(null,null);E=D;try{return n(t)}finally{E=e}},h.on=function F(t,e,u,o){function F(n){var u=b;return t(),o?o=!1:(b=null,n=e(n),b=u),n}return Array.isArray(t)&&(t=n(t)),o=!!o,h(F,u)},h.data=function(n){var t=new v(n);return function(n){if(arguments.length>0){if(m)if(t.pending!==R){if(n!==t.pending)throw new Error("conflicting changes: "+n+" !== "+t.pending)}else t.pending=n,S.add(t);else t.log?(t.pending=n,o(t)):t.value=n;return n}return b&&e(t,b),t.value}},h.value=function(n,t){var e=h.data(n),u=0;return function o(r){if(0===arguments.length)return e();var i=t?t(n,r):n===r;if(!i){if(u===y)throw new Error("conflicting values: "+o+" is not the same as "+n);u=y,n=r,e(r)}return r}},h.freeze=function(n){var t;if(m)t=n();else{m=!0,S.reset();try{t=n(),o(null)}finally{m=!1}}return t},h.sample=function(n){var t,e=b;return e?(b=null,t=n(),b=e):t=n(),t},h.cleanup=function(n){if(!E)throw new Error("S.cleanup() must be called from within an S() computation.  Cannot call it at toplevel.");(E.cleanups||(E.cleanups=[])).push(n)};var v=function(){function n(n){this.value=n,this.pending=R,this.log=null}return n}(),g=function(){function n(t,e){this.fn=t,this.value=e,this.id=n.count++,this.age=y,this.state=k,this.count=0,this.sources=[],this.log=null,this.owned=null,this.cleanups=null}return n}();g.count=0;var p=function(){function n(){this.count=0,this.nodes=[],this.ids=[]}return n}(),w=function(){function n(){this.items=[],this.count=0}return n.prototype.reset=function(){this.count=0},n.prototype.add=function(n){this.items[this.count++]=n},n.prototype.run=function(n){for(var t=this.items,e=this.count,u=0;u<e;u++)n(t[u]),t[u]=null;this.count=0},n}(),y=1,m=!1,E=null,b=null,S=new w,j=new w,x=new w,A=new w,z=new g(null,null),C=new g(null,null),R={},k=0,q=1,B=2;"object"==typeof module&&"object"==typeof module.exports?module.exports=h:"function"==typeof define?define([],function(){return h}):(eval||function(){})("this").S=h}();