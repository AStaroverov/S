!function(t){var e={};t(function(t,n,i){if(e.hasOwnProperty(t))throw new Error("define: cannot redefine module "+t);e[t]=i.apply(null,n.map(function(n){if(!e.hasOwnProperty(n))throw new Error("define: module "+n+" required by "+t+" has not been defined.");return e[n]}))}),"object"==typeof module&&"object"==typeof module.exports?module.exports=e.S:"function"==typeof define?define([],function(){return e.S}):this.S=e.S}(function(t){"use strict";t("graph",[],function(){function t(){this.count=1,this.target=null,this.deferred=[]}function e(t){this.id=t.count++,this.lineage=t.target?t.target.lineage:[],this.updates=[]}function n(t,e,n){var i,r,s;for(this.lineage=n.target?n.target.lineage.slice(0):[],this.lineage.push(this),this.scheduler=e.update,this.updaters=[],this.listening=!0,this.generating=!1,this.gen=1,this.dependencies=[],this.dependenciesIndex={},this.cleanups=[],this.finalizers=[],i=this.lineage.length-1;i>=0;i--)r=this.lineage[i],r.scheduler&&(t=r.scheduler(t)),this.updaters[i]=t;if(e.sources){s=n.target,n.target=this;try{for(i=0;i<e.sources.length;i++)e.sources[i]()}finally{n.target=s}this.listening=!1}}function i(t,e){this.active=!0,this.gen=t.gen,this.updates=e.updates,this.offset=e.updates.length;for(var n=0,i=Math.min(t.lineage.length,e.lineage.length);i>n&&t.lineage[n]===e.lineage[n];n++);this.update=t.updaters[n],this.updates.push(this.update),t.dependencies.push(this),t.dependenciesIndex[e.id]=this}return t.prototype={reportReference:function(t){this.target&&this.target.addSource(t)},reportFormula:function(t){this.target&&this.target.addChild(t)},runDeferred:function(){if(!this.target)for(;0!==this.deferred.length;)this.deferred.shift()()}},e.prototype={propagate:function(){var t,e,n=this.updates;for(t=0;t<n.length;t++)e=n[t],e&&e()}},n.prototype={beginUpdate:function(){this.cleanup(),this.gen++},endUpdate:function(){if(this.listening){var t,e;for(t=0;t<this.dependencies.length;t++)e=this.dependencies[t],e.active&&e.gen<this.gen&&e.deactivate()}},addChild:function(t){(this.generating?this.finalizers:this.cleanups).push(t)},addSource:function(t){if(this.listening){var e=this.dependenciesIndex[t.id];e?e.activate(this.gen):new i(this,t)}},cleanup:function(){for(var t=0;t<this.cleanups.length;t++)this.cleanups[t]();this.cleanups=[]},dispose:function(){var t;for(t=0;t<this.finalizers.length;t++)this.finalizers[t]();for(t=this.dependencies.length-1;t>=0;t--)this.dependencies[t].deactivate()}},i.prototype={activate:function(t){this.active||(this.active=!0,this.updates[this.offset]=this.update),this.gen=t},deactivate:function(){this.active&&(this.updates[this.offset]=null),this.active=!1}},{Overseer:t,Source:e,Target:n,Dependency:i}}),t("S",["graph"],function(t){function e(e){function n(t){if(arguments.length>0){if(void 0===t)throw new Error("S.data can't be set to undefined.  In S, undefined is reserved for namespace lookup failures.");e=t,r.propagate(),m.runDeferred()}else m.reportReference(r);return e}if(void 0===e)throw new Error("S.data can't be initialized with undefined.  In S, undefined is reserved for namespace lookup failures.");var r=new t.Source(m);return n.toJSON=i,Array.isArray(e)&&h(n),n}function n(e,n){function i(){return m.reportReference(a),o}function r(){if(!u){u=!0;var t,n;t=m.target,m.target=f,f.beginUpdate();try{n=e(),void 0!==n&&(o=n,a.propagate())}finally{u=!1,m.target=t}f.endUpdate()}}function s(){f.cleanup(),f.dispose()}n=n||{};var o,u,a=new t.Source(m),f=new t.Target(r,n,m);return m.reportFormula(s),i.dispose=s,(n.init?n.init(r):r)(),m.runDeferred(),i}function i(){return this()}function r(t){if(!m.target||!m.target.listening)return t();m.target.listening=!1;try{return t()}finally{m.target.listening=!0}}function s(t){if(!m.target||m.target.generating)return t();m.target.generating=!0;try{return t()}finally{m.target.generating=!1}}function o(t){m.target?m.deferred.push(t):t()}function u(t){if(!m.target)throw new Error("S.cleanup() must be called from within an S.formula.  Cannot call it at toplevel.");m.target.cleanups.push(t)}function a(t){if(!m.target)throw new Error("S.finalize() must be called from within an S.formula.  Cannot call it at toplevel.");m.target.finalizers.push(t)}function f(t,e){return function(n){return 0!==arguments.length&&e(n),t()}}function c(t){return JSON.stringify(t,function(t,e){return"function"==typeof e?e():e})}function h(t){t.push=p,t.pop=d,t.shift=l,t.unshift=g,t.splice=v,t.remove=y}function p(t){var e=r(this);return e.push(t),this(e),t}function d(){var t=r(this),e=t.pop();return this(t),e}function l(){var t=r(this),e=t.shift();return this(t),e}function g(t){var e=r(this);return e.unshift(t),this(e),t}function v(){var t=r(this),e=t.splice.apply(t,arguments);return this(t),e}function y(t){var e=r(this),n=e.indexOf(t);return-1!==n?(e.splice(n,1),this(e),t):void 0}var m=new t.Overseer;return n.data=e,n.peek=r,n.defer=o,n.proxy=f,n.cleanup=u,n.finalize=a,n.generator=s,n.toJSON=c,n}),t("schedulers",["S"],function(t){function e(){return function(){}}function n(t){return function(e){var n=!1;return function(){n||(n=!0,t(function(){n=!1,e()}))}}}function i(t){return void 0!==t?u(t):n(u)}function r(t){return function(e){var n=0,i=!1;return function(){if(!i){var r=Date.now();r-n>t?(n=r,e()):(i=!0,setTimeout(function(){n=Date.now(),i=!1,e()},t-(r-n)))}}}}function s(t){return function(e){var n=0,i=0;return function(){var r=Date.now();r>n&&(n=r,i&&clearTimeout(i),i=setTimeout(function(){e()},t))}}}function o(){function t(t){n.push(t)}function e(){for(var t=0;t<n.length;t++)n[t]();n=[]}var n=[];return t.go=e,t}var u=t.defer;return{stop:e,pause:n,defer:i,throttle:r,debounce:s,stopsign:o}}),t("FormulaOptionBuilder",["S","schedulers"],function(t,e){function n(){this.options={sources:null,update:null,init:null,generator:!1}}function i(t,e){return e?function(){return t(e())}:t}function r(t,e){return t?t.concat(e):e}function s(t,e){t.options.update=i(e,t.options.update)}function o(t,e){t.options.init=i(e,t.options.init)}n.prototype={S:function(e){return t(e,this.options)},on:function(t){return t=t?Array.isArray(t)?t:[t]:[],this.options.sources=r(this.options.sources,t),this},once:function(){return this.options.sources=[],this},skipFirst:function(){if(null===this.options.sources||0===this.options.sources.length)throw new Error("to use skipFirst, you must first have specified at least one dependency with .on(...)");return o(this,modifiers.stop),this}},"defer throttle debounce pause".split(" ").map(function(t){n.prototype[t]=function(n){return s(this,e[t](n)),this}}),"on once defer throttle debounce pause".split(" ").map(function(e){t[e]=function(t){return(new n)[e](t)}}),t.stopsign=e.stopsign})});