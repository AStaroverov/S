!function(t){var e={};t(function(t,n,i){if(e.hasOwnProperty(t))throw new Error("define: cannot redefine module "+t);e[t]=i.apply(null,n.map(function(n){if(!e.hasOwnProperty(n))throw new Error("define: module "+n+" required by "+t+" has not been defined.");return e[n]}))}),"object"==typeof module&&"object"==typeof module.exports?module.exports=e.S:"function"==typeof define?define([],function(){return e.S}):this.S=e.S}(function(t){"use strict";t("graph",[],function(){function t(){this.count=1,this.target=null,this.deferred=[]}function e(t){this.id=t.count++,this.lineage=t.target?t.target.lineage:[],this.updates=[]}function n(t,e,n){var i,r,s;for(this.lineage=n.target?n.target.lineage.slice(0):[],this.lineage.push(this),this.scheduler=e.update,this.listening=!0,this.pinning=e.pinning||!1,this.locked=!0,this.gen=1,this.dependencies=[],this.dependenciesIndex={},this.cleanups=[],this.finalizers=[],this.updaters=new Array(this.lineage.length+1),this.updaters[this.lineage.length]=t,i=this.lineage.length-1;i>=0;i--)r=this.lineage[i],r.scheduler&&(t=r.scheduler(t)),this.updaters[i]=t;if(e.sources){s=n.target,n.target=this,this.locked=!1;try{for(i=0;i<e.sources.length;i++)e.sources[i]()}finally{this.locked=!0,n.target=s}this.listening=!1}}function i(t,e){this.active=!0,this.gen=t.gen,this.updates=e.updates,this.offset=e.updates.length;for(var n=0,i=Math.min(t.lineage.length,e.lineage.length);i>n&&t.lineage[n]===e.lineage[n];n++);this.update=t.updaters[n],this.updates.push(this.update),t.dependencies.push(this),t.dependenciesIndex[e.id]=this}return t.prototype={reportReference:function(t){this.target&&this.target.addSource(t)},reportFormula:function(t,e){this.target&&this.target.addSubformula(t,e)},runDeferred:function(){if(!this.target)for(;0!==this.deferred.length;)this.deferred.shift()()}},e.prototype={propagate:function(){var t,e,n=this.updates,i=n.length;for(t=0;i>t;t++)e=n[t],e&&e()},dispose:function(){this.lineage=null,this.updates.length=0}},n.prototype={beginUpdate:function(){this.cleanup(),this.gen++},endUpdate:function(){if(this.listening){var t,e;for(t=0;t<this.dependencies.length;t++)e=this.dependencies[t],e.active&&e.gen<this.gen&&e.deactivate()}},addSubformula:function(t,e){if(this.locked)throw new Error("Cannot create a new subformula except while updating the parent");(e||this.pinning?this.finalizers:this.cleanups).push(t)},addSource:function(t){if(this.listening&&!this.locked){var e=this.dependenciesIndex[t.id];e?e.activate(this.gen,t):new i(this,t)}},cleanup:function(){for(var t=0;t<this.cleanups.length;t++)this.cleanups[t]();this.cleanups=[]},dispose:function(){var t;for(this.cleanup(),t=0;t<this.finalizers.length;t++)this.finalizers[t]();for(t=this.dependencies.length-1;t>=0;t--)this.dependencies[t].deactivate();this.lineage=null,this.scheduler=null,this.updaters=null,this.cleanups=null,this.finalizers=null,this.dependencies=null,this.dependenciesIndex=null}},i.prototype={activate:function(t,e){this.active||(this.active=!0,this.updates=e.updates,this.updates[this.offset]=this.update),this.gen=t},deactivate:function(){this.active&&(this.updates[this.offset]=null,this.updates=null),this.active=!1}},{Overseer:t,Source:e,Target:n,Dependency:i}}),t("core",["graph"],function(t){function e(e){function n(t){return arguments.length>0?(e=t,i.propagate(),l.runDeferred()):l.reportReference(i),e}var i=new t.Source(l);return n.toJSON=r,n}function n(){this.sources=null,this.pin=!1,this.update=null,this.init=null}function i(e,n){function i(){return c&&l.reportReference(c),u}function s(){if(!a&&h){a=!0;var t;t=l.target,l.target=h,h.beginUpdate(),h.locked=!1;try{u=e(),h&&(h.locked=!0),c&&c.propagate()}finally{a=!1,h&&(h.locked=!0),l.target=t}h&&h.endUpdate()}}function o(){c&&(c.dispose(),h.dispose()),c=h=e=u=void 0}var u,a,c=new t.Source(l),h=new t.Target(s,n,l);return l.reportFormula(o,n.pin),i.dispose=o,i.toJSON=r,(n.init?n.init(s):s)(),l.runDeferred(),i}function r(){return this()}function s(t){if(!l.target||!l.target.listening)return t();l.target.listening=!1;try{return t()}finally{l.target.listening=!0}}function o(t){if(!l.target||l.target.pinning)return t();l.target.pinning=!0;try{return t()}finally{l.target.pinning=!1}}function u(t){l.target?l.deferred.push(t):t()}function a(t){if(!l.target)throw new Error("S.cleanup() must be called from within an S.formula.  Cannot call it at toplevel.");l.target.cleanups.push(t)}function c(t){if(!l.target)throw new Error("S.finalize() must be called from within an S.formula.  Cannot call it at toplevel.");l.target.finalizers.push(t)}var l=new t.Overseer;return{data:e,FormulaOptions:n,formula:i,defer:u,peek:s,pin:o,cleanup:a,finalize:c}}),t("schedulers",["core"],function(t){function e(){return function(){}}function n(t){return function(e){var n=!1;return function(){n||(n=!0,t(function(){n=!1,e()}))}}}function i(){return n(t.defer)}function r(t){return function(e){var n=0,i=!1;return function(){if(!i){var r=Date.now();r-n>t?(n=r,e()):(i=!0,setTimeout(function(){n=Date.now(),i=!1,e()},t-(r-n)))}}}}function s(t){return function(e){var n=0,i=0;return function(){var r=Date.now();r>n&&(n=r,i&&clearTimeout(i),i=setTimeout(function(){e()},t))}}}function o(){function t(t){n.push(t)}function e(){for(var t=0;t<n.length;t++)n[t]();n=[]}var n=[];return t.go=e,t}function u(t){return function(e){for(var n=0;n<t.length;n++)if(void 0===t[n]())return;e()}}return{stop:e,pause:n,defer:i,throttle:r,debounce:s,stopsign:o,when:u}}),t("options",["core","schedulers"],function(t,e){function n(){this.options=new t.FormulaOptions}function i(t,e){return e?function(){return t(e())}:t}function r(t,e){return t?t.concat(e):e}function s(t,e){t.options.update=i(e,t.options.update)}function o(t,e){t.options.init=i(e,t.options.init)}return n.prototype={on:function(t){return t=t?Array.isArray(t)?t:[t]:[],this.options.sources=r(this.options.sources,t),this},once:function(){return this.options.sources=[],this},pin:function(){return this.options.pin=!0,this},when:function(t){t=t?Array.isArray(t)?t:[t]:[],this.options.sources=r(this.options.sources,t);var n=e.pause(e.when(t));return o(this,n),s(this,n),this}},"defer throttle debounce pause".split(" ").map(function(t){n.prototype[t]=function(n){return s(this,e[t](n)),this}}),{FormulaOptionsBuilder:n}}),t("misc",[],function(){function t(t,e){return function(n){return 0!==arguments.length&&e(n),t()}}return{proxy:t}}),t("S",["core","options","schedulers","misc"],function(t,e,n,i){function r(e){var n,i;return arguments.length>1&&(n=e,i=Array.prototype.slice.call(arguments,1),e=function(){return n.apply(null,i)}),t.formula(e,new t.FormulaOptions)}return r.data=t.data,r.peek=t.peek,r.cleanup=t.cleanup,r.finalize=t.finalize,"on once when defer throttle debounce pause".split(" ").map(function(t){r[t]=function(n){return(new e.FormulaOptionsBuilder)[t](n)}}),r.pin=function(n){return 0===arguments.length?(new e.FormulaOptionsBuilder).pin():void t.pin(n)},e.FormulaOptionsBuilder.prototype.S=function(e){var n,i;return arguments.length>1&&(n=e,i=Array.prototype.slice.call(arguments,1),e=function(){return n.apply(null,i)}),t.formula(e,this.options)},r.stopsign=n.stopsign,r.proxy=i.proxy,r})});