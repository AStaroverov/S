!function(t){var e={};t(function(t,n,i){if(e.hasOwnProperty(t))throw new Error("define: cannot redefine module "+t);e[t]=i.apply(null,n.map(function(n){if(!e.hasOwnProperty(n))throw new Error("define: module "+n+" required by "+t+" has not been defined.");return e[n]}))}),"object"==typeof module&&"object"==typeof module.exports?module.exports=e.S:"function"==typeof define?define([],function(){return e.S}):this.S=e.S}(function(t){"use strict";t("graph",[],function(){function t(){this.count=1,this.target=null,this.deferred=[]}function e(t){this.id=t.count++,this.lineage=t.target?t.target.lineage:[],this.updates=[]}function n(t,e,n){var i,r;for(this.lineage=n.target?n.target.lineage.slice(0):[],this.lineage.push(this),this.mod=e.update,this.updaters=[],this.updating=!1,this.listening=!0,this.gen=1,this.dependencies=[],this.dependenciesIndex={},this.cleanups=[],this.finalizers=[],i=this.lineage.length-1;i>=0;i--)r=this.lineage[i],r.mod&&(t=r.mod(t,this)),this.updaters[i]=t;e.sources&&(n.runWithTarget(function(){for(var t=0;t<e.sources.length;t++)e.sources[t]()},this),this.listening=!1)}function i(t,e){this.active=!0,this.gen=t.gen,this.updates=e.updates,this.offset=e.updates.length;for(var n=0,i=Math.min(t.lineage.length,e.lineage.length);i>n&&t.lineage[n]===e.lineage[n];n++);this.update=t.updaters[n],this.updates.push(this.update),t.dependencies.push(this),t.dependenciesIndex[e.id]=this}return t.prototype={addSource:function(t){this.target&&this.target.addSource(t)},addChild:function(t){this.target&&this.target.addChild(t)},runWithTarget:function(t,e){if(!e.updating){var n,i;return n=this.target,this.target=e,e.beginUpdate(),e.updating=!0,i=this.runWithTargetInner(t,n),e.endUpdate(),i}},runWithTargetInner:function(t,e){try{return t()}finally{this.target.updating=!1,this.target=e}},peek:function(t){var e;if(!this.target)return t();e=this.target.listening,this.target.listening=!1;try{return t()}finally{this.target.listening=e}},runDeferred:function(){if(!this.target)for(;0!==this.deferred.length;)this.deferred.shift()()}},e.prototype={propagate:function(){var t,e,n=this.updates;for(t=0;t<n.length;t++)e=n[t],e&&e()}},n.prototype={beginUpdate:function(){this.cleanup(),this.gen++},endUpdate:function(){if(this.listening){var t,e;for(t=0;t<this.dependencies.length;t++)e=this.dependencies[t],e.active&&e.gen<this.gen&&e.deactivate()}},addSource:function(t){if(this.listening){var e=this.dependenciesIndex[t.id];e?e.activate(this.gen):new i(this,t)}},addChild:function(t){this.cleanups.push(t)},cleanup:function(){for(var t=0;t<this.cleanups.length;t++)this.cleanups[t]();this.cleanups=[]},dispose:function(){var t;for(t=0;t<this.finalizers.length;t++)this.finalizers[t]();for(t=this.dependencies.length-1;t>=0;t--)this.dependencies[t].deactivate()}},i.prototype={activate:function(t){this.active||(this.active=!0,this.updates[this.offset]=this.update),this.gen=t},deactivate:function(){this.active&&(this.updates[this.offset]=null),this.active=!1}},{Recorder:t,Source:e,Target:n,Dependency:i}}),t("S",["graph"],function(t){function e(t,n){return e.lift(t,n)}function n(t,n){return"function"==typeof t?r(t,n):t instanceof Array?e.seq(t):i(t)}function i(e){function n(t){if(arguments.length>0){if(void 0===t)throw new Error("S.data can't be set to undefined.  In S, undefined is reserved for namespace lookup failures.");e=t,i.propagate(),d.runDeferred()}else d.addSource(i);return e}if(void 0===e)throw new Error("S.data can't be initialized with undefined.  In S, undefined is reserved for namespace lookup failures.");var i=new t.Source(d);return n.toString=o,n}function r(e,n){function i(){return d.addSource(f),a}function r(){d.runWithTarget(o,c)}function o(){var t=e();void 0!==t&&(a=t,f.propagate())}function u(){c.cleanup(),c.dispose()}function s(){return"[formula: "+(void 0!==a?a+" - ":"")+e+"]"}n=n||{};var a,f=new t.Source(d),c=new t.Target(r,n,d);return d.addChild(u),i.dispose=u,i.toString=s,(n.init?n.init(r):r)(),d.runDeferred(),i}function o(){return"[data: "+e.peek(this)+"]"}function u(t){return d.peek(t)}function s(t){d.target?d.deferred.push(t):t()}function a(t){if(!d.target)throw new Error("S.cleanup() must be called from within an S.formula.  Cannot call it at toplevel.");d.target.cleanups.push(t)}function f(t){if(!d.target)throw new Error("S.finalize() must be called from within an S.formula.  Cannot call it at toplevel.");d.target.finalizers.push(t)}function c(t,e){return function(n){return 0!==arguments.length&&e(n),t()}}function h(t){return JSON.stringify(t,function(t,e){return"function"==typeof e?e():e})}var d=new t.Recorder;return e.lift=n,e.data=i,e.formula=r,e.peek=u,e.defer=s,e.proxy=c,e.cleanup=a,e.finalize=f,e.toJSON=h,e}),t("schedulers",["S"],function(t){function e(){return function(){}}function n(t){return void 0!==t?u(t):function(t){var e=!1;return function(){e||(e=!0,u(function(){e=!1,t()}))}}}function i(t){return function(e){var n=0,i=!1;return function(){if(!i){var r=Date.now();r-n>t?(n=r,e()):(i=!0,setTimeout(function(){n=Date.now(),i=!1,e()},t-(r-n)))}}}}function r(t){return function(e){var n=0,i=0;return function(){var r=Date.now();r>n&&(n=r,i&&clearTimeout(i),i=setTimeout(function(){e()},t))}}}function o(e){return function(n,i){var r,o=[],u=!1,s=t.on(e).S(function(){for(;!(r=e())&&o.length;){var t=o.shift();t()}});return i.finalizers.push(s.dispose),function(){if(r){if(u)return;u=!0,o.push(function(){u=!1,n()})}else n()}}}var u=t.defer;return{stop:e,defer:n,throttle:i,debounce:r,pause:o}}),t("FormulaOptionBuilder",["S","schedulers"],function(t,e){function n(){this.options={sources:null,update:null,init:null}}function i(t,e){return e?function(){return t(e())}:t}function r(t,e){return t?t.concat(e):e}function o(t,e){t.options.update=i(e,t.options.update)}function u(t,e){t.options.init=i(e,t.options.init)}n.prototype={S:function(e){return t.formula(e,this.options)},on:function(t){return t=t?Array.isArray(t)?t:[t]:[],this.options.sources=r(this.options.sources,t),this},once:function(){return this.options.sources=[],this},skipFirst:function(){if(null===this.options.sources||0===this.options.sources.length)throw new Error("to use skipFirst, you must first have specified at least one dependency with .on(...)");return u(this,modifiers.stop),this}},"defer throttle debounce pause".split(" ").map(function(t){n.prototype[t]=function(n){return o(this,e[t](n)),this}}),"on once defer throttle debounce pause".split(" ").map(function(e){t[e]=function(t){return(new n)[e](t)}})})});